<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Velocite Systems Protected Point to Point Solution: p3knet.h File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>p3knet.h File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
<h3>Protected Point to Point network header file</h3>
<p>
Copyright (C) Velocite 2010 
<p>
<code>#include &quot;<a class="el" href="p3kbase_8h-source.html">p3kbase.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="p3ksession_8h-source.html">p3ksession.h</a>&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for p3knet.h:</div>
<div class="dynsection">
<p><center><img src="p3knet_8h__incl.png" border="0" usemap="#p3knet.h_map" alt=""></center>
<map name="p3knet.h_map">
<area shape="rect" href="p3kbase_8h.html" title="p3kbase.h" alt="" coords="737,161,825,188"><area shape="rect" href="p3ksession_8h.html" title="p3ksession.h" alt="" coords="819,84,923,111"><area shape="rect" href="p3linux_8h.html" title="p3linux.h" alt="" coords="800,239,877,265"><area shape="rect" href="p3kcrypto_8h.html" title="p3kcrypto.h" alt="" coords="849,161,945,188"></map>
</div>

<p>
<div class="dynheader">
This graph shows which files directly or indirectly include this file:</div>
<div class="dynsection">
<p><center><img src="p3knet_8h__dep__incl.png" border="0" usemap="#p3knet.hdep_map" alt=""></center>
<map name="p3knet.hdep_map">
<area shape="rect" href="p3knet_8c.html" title="p3knet.c" alt="" coords="127,84,201,111"><area shape="rect" href="p3kprimary_8h.html" title="p3kprimary.h" alt="" coords="225,84,329,111"><area shape="rect" href="p3ksecondary_8h.html" title="p3ksecondary.h" alt="" coords="353,84,473,111"><area shape="rect" href="p3ksession_8c.html" title="p3ksession.c" alt="" coords="497,84,601,111"><area shape="rect" href="p3linux_8c.html" title="p3linux.c" alt="" coords="625,84,703,111"><area shape="rect" href="p3kpri__session_8c.html" title="p3kpri_session.c" alt="" coords="5,161,131,188"><area shape="rect" href="p3kprimary_8c.html" title="p3kprimary.c" alt="" coords="155,161,256,188"><area shape="rect" href="p3kprimaryplus_8h.html" title="p3kprimaryplus.h" alt="" coords="280,161,411,188"><area shape="rect" href="p3kprimaryplus_8c.html" title="p3kprimaryplus.c" alt="" coords="280,239,411,265"><area shape="rect" href="p3ksec__session_8c.html" title="p3ksec_session.c" alt="" coords="435,161,565,188"><area shape="rect" href="p3ksecondary_8c.html" title="p3ksecondary.c" alt="" coords="589,161,709,188"></map>
</div>

<p>
<a href="p3knet_8h-source.html">Go to the source code of this file.</a><table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__p3route.html">_p3route</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__p3net.html">_p3net</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct__p3packet.html">_p3packet</a></td></tr>

<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#12418b6b438fdcdce936f274c5fac73e">p3PKTS_NOMOD</a>&nbsp;&nbsp;&nbsp;0x00</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#ea5e25a22feb2d5ccccb1d09d7efa8a6">p3PKTS_ADDHDR</a>&nbsp;&nbsp;&nbsp;0x01</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#324dde31b5ad72d07a4d82576db3be42">p3PKTS_RMVHDR</a>&nbsp;&nbsp;&nbsp;0x02</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#138e28335249b56be70ec84c86fdba7b">p3PKTS_CONTROL</a>&nbsp;&nbsp;&nbsp;0x04</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#651cc9599def7abf0c9b8f784e4e2589">p3PKTS_RAWSOCK</a>&nbsp;&nbsp;&nbsp;0x08</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#06937a9194c7fe3485f61c9427c1a07e">p3PKTS_CHKSUM</a>&nbsp;&nbsp;&nbsp;0x10</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#11277fc26334bc7c2d920bac2d35bef6">p3TCP_CHECK</a>&nbsp;&nbsp;&nbsp;1</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#5a754675d76fae7b77c9f64678144e37">p3TCP_CHECK_ADD</a>&nbsp;&nbsp;&nbsp;2</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#516e2e3c91b210741721c4db0917817b">p3GET_MTU</a>&nbsp;&nbsp;&nbsp;3</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#3f3fb6b85c2d89481dbaf58a85a4a5ef">p3SEND_CTL</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#da9ebd6febf4addfa2eaa0ef1dae6cde">p3IP4_ID</a>&nbsp;&nbsp;&nbsp;4</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#a252ad5ee8a54a28b25907b08facb89a">p3IP4_SADDR</a>&nbsp;&nbsp;&nbsp;12</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#a670226bc2558cac0e89411f9cf7bf07">p3IP4_DADDR</a>&nbsp;&nbsp;&nbsp;16</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#b3e0ec26ce4f3823b098735e3a6cfc44">p3MSS</a>&nbsp;&nbsp;&nbsp;536</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#1bbadecc123741b01726f49674112c08">p3EXTRA_V4</a>&nbsp;&nbsp;&nbsp;128</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#014a24c9be04290b9d79a566173a0599">p3MSS_V4</a>&nbsp;&nbsp;&nbsp;p3MSS + p3EXTRA_V4</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#7c243ece9ccfe0d4b70f20e1c4e81a30">p3EXTRA_V6</a>&nbsp;&nbsp;&nbsp;148</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#1ee293725b0d49e0fb622f7ebd58f4af">p3MSS_V6</a>&nbsp;&nbsp;&nbsp;p3MSS + p3EXTRA_V6</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#f33909afec94510a2ad20c18208190af">P3MAXROUTE</a>&nbsp;&nbsp;&nbsp;8</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#51c2a0d7c585283910d74e62e8ca537d">p3PKT_SIZE</a>&nbsp;&nbsp;&nbsp;0x0000ffff</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#143508142f19f1bdc4940347512c6484">p3PKT_P3SRC</a>&nbsp;&nbsp;&nbsp;0x00010000</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#e955037f864780e67ed84ef55e342f36">p3PKT_P3DST</a>&nbsp;&nbsp;&nbsp;0x00020000</td></tr>

<tr><td colspan="2"><br><h2>Typedefs</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef struct <a class="el" href="struct__p3route.html">_p3route</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#461272c2dc749c8d1083390d51e9d617">p3route</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef struct <a class="el" href="struct__p3net.html">_p3net</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#fde6196c28f8fb25461fc434a8374e40">p3net</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">typedef struct <a class="el" href="struct__p3packet.html">_p3packet</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#004552a0e2c2e9846b0a3303ab69f706">p3packet</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#ebcb19f32b96fdb0c580e57088828b4a">init_p3net</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#477c7725aa7c5d922a3e6f4cf59c419f">build_p3table</a> (<a class="el" href="struct__p3net.html">p3net</a> *net, int ipver)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#f447819ecfcd4e69349a017e7d8a13cd">packet_handler</a> (<a class="el" href="struct__p3packet.html">p3packet</a> *pkt, void *p3sys_net)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#7d8e3f552c7187072e555bf504fec819">p3_lookup</a> (<a class="el" href="struct__p3packet.html">p3packet</a> *pkt)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#aea152b37791da68ffdf7029305935dc">encrypt_packet</a> (<a class="el" href="struct__p3session.html">p3session</a> *<a class="el" href="p3ksession_8h.html#f01e1812f2bb3a71e6bdf3a19a4120f8">p3sess</a>, unsigned char *packet)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">unsigned char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#70f83668afef962d8ca62ab415899cc0">decrypt_packet</a> (<a class="el" href="struct__p3session.html">p3session</a> *<a class="el" href="p3ksession_8h.html#f01e1812f2bb3a71e6bdf3a19a4120f8">p3sess</a>, unsigned char *packet)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#e42b8ad940d0e2e7f53e7e4096934645">p3send_control</a> (<a class="el" href="struct__p3session.html">p3session</a> *session, <a class="el" href="struct__p3ctlmsg.html">p3ctlmsg</a> *cmsg)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct__p3route.html">p3route</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#c23de86e4ad7c3a7fa624b9a8c1c2b56">ipv4route</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct__p3route.html">p3route</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#b0ef994e33f019f8ff1da7b214cab5f3">ipv6route</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct__p3host.html">p3host</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3knet_8h.html#b0ef672ac9ffe9efaff389eae79bbcd9">p3hosts</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="12418b6b438fdcdce936f274c5fac73e"></a><!-- doxytag: member="p3knet.h::p3PKTS_NOMOD" ref="12418b6b438fdcdce936f274c5fac73e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3PKTS_NOMOD&nbsp;&nbsp;&nbsp;0x00          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Packet is unmodified 
</div>
</div><p>
<a class="anchor" name="ea5e25a22feb2d5ccccb1d09d7efa8a6"></a><!-- doxytag: member="p3knet.h::p3PKTS_ADDHDR" ref="ea5e25a22feb2d5ccccb1d09d7efa8a6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3PKTS_ADDHDR&nbsp;&nbsp;&nbsp;0x01          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Packet header added (implies encryption) 
<p>Referenced by <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

</div>
</div><p>
<a class="anchor" name="324dde31b5ad72d07a4d82576db3be42"></a><!-- doxytag: member="p3knet.h::p3PKTS_RMVHDR" ref="324dde31b5ad72d07a4d82576db3be42" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3PKTS_RMVHDR&nbsp;&nbsp;&nbsp;0x02          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Packet header removed (implies decryption) 
<p>Referenced by <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

</div>
</div><p>
<a class="anchor" name="138e28335249b56be70ec84c86fdba7b"></a><!-- doxytag: member="p3knet.h::p3PKTS_CONTROL" ref="138e28335249b56be70ec84c86fdba7b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3PKTS_CONTROL&nbsp;&nbsp;&nbsp;0x04          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Control packet handled by P3 processing 
<p>Referenced by <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

</div>
</div><p>
<a class="anchor" name="651cc9599def7abf0c9b8f784e4e2589"></a><!-- doxytag: member="p3knet.h::p3PKTS_RAWSOCK" ref="651cc9599def7abf0c9b8f784e4e2589" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3PKTS_RAWSOCK&nbsp;&nbsp;&nbsp;0x08          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Packet is establishing a raw socket 
<p>Referenced by <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

</div>
</div><p>
<a class="anchor" name="06937a9194c7fe3485f61c9427c1a07e"></a><!-- doxytag: member="p3knet.h::p3PKTS_CHKSUM" ref="06937a9194c7fe3485f61c9427c1a07e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3PKTS_CHKSUM&nbsp;&nbsp;&nbsp;0x10          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Handle checksum for stack 
<p>Referenced by <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

</div>
</div><p>
<a class="anchor" name="11277fc26334bc7c2d920bac2d35bef6"></a><!-- doxytag: member="p3knet.h::p3TCP_CHECK" ref="11277fc26334bc7c2d920bac2d35bef6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3TCP_CHECK&nbsp;&nbsp;&nbsp;1          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Set a TCP checksum 
<p>Referenced by <a class="el" href="p3linux_8c-source.html#l00816">p3net_utils()</a>, and <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

</div>
</div><p>
<a class="anchor" name="5a754675d76fae7b77c9f64678144e37"></a><!-- doxytag: member="p3knet.h::p3TCP_CHECK_ADD" ref="5a754675d76fae7b77c9f64678144e37" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3TCP_CHECK_ADD&nbsp;&nbsp;&nbsp;2          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Set a TCP checksum for an added MSS field 
<p>Referenced by <a class="el" href="p3linux_8c-source.html#l00816">p3net_utils()</a>, and <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

</div>
</div><p>
<a class="anchor" name="516e2e3c91b210741721c4db0917817b"></a><!-- doxytag: member="p3knet.h::p3GET_MTU" ref="516e2e3c91b210741721c4db0917817b" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3GET_MTU&nbsp;&nbsp;&nbsp;3          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Get the MTU for an interface 
<p>Referenced by <a class="el" href="p3linux_8c-source.html#l00816">p3net_utils()</a>, and <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

</div>
</div><p>
<a class="anchor" name="3f3fb6b85c2d89481dbaf58a85a4a5ef"></a><!-- doxytag: member="p3knet.h::p3SEND_CTL" ref="3f3fb6b85c2d89481dbaf58a85a4a5ef" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3SEND_CTL&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Send a P3 control packet 
<p>Referenced by <a class="el" href="p3linux_8c-source.html#l00816">p3net_utils()</a>, and <a class="el" href="p3knet_8c-source.html#l00733">p3send_control()</a>.</p>

</div>
</div><p>
<a class="anchor" name="da9ebd6febf4addfa2eaa0ef1dae6cde"></a><!-- doxytag: member="p3knet.h::p3IP4_ID" ref="da9ebd6febf4addfa2eaa0ef1dae6cde" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3IP4_ID&nbsp;&nbsp;&nbsp;4          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
IPv4 identifier field offset 
<p>Referenced by <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

</div>
</div><p>
<a class="anchor" name="a252ad5ee8a54a28b25907b08facb89a"></a><!-- doxytag: member="p3knet.h::p3IP4_SADDR" ref="a252ad5ee8a54a28b25907b08facb89a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3IP4_SADDR&nbsp;&nbsp;&nbsp;12          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
IPv4 source address field offset 
</div>
</div><p>
<a class="anchor" name="a670226bc2558cac0e89411f9cf7bf07"></a><!-- doxytag: member="p3knet.h::p3IP4_DADDR" ref="a670226bc2558cac0e89411f9cf7bf07" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3IP4_DADDR&nbsp;&nbsp;&nbsp;16          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
IPv4 destination address field offset 
<p>Referenced by <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

</div>
</div><p>
<a class="anchor" name="b3e0ec26ce4f3823b098735e3a6cfc44"></a><!-- doxytag: member="p3knet.h::p3MSS" ref="b3e0ec26ce4f3823b098735e3a6cfc44" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3MSS&nbsp;&nbsp;&nbsp;536          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Minimum IPv4 segment size 
<p>Referenced by <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

</div>
</div><p>
<a class="anchor" name="1bbadecc123741b01726f49674112c08"></a><!-- doxytag: member="p3knet.h::p3EXTRA_V4" ref="1bbadecc123741b01726f49674112c08" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3EXTRA_V4&nbsp;&nbsp;&nbsp;128          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Extra buffer space needed for IPv4 P3 packet 
<p>Referenced by <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

</div>
</div><p>
<a class="anchor" name="014a24c9be04290b9d79a566173a0599"></a><!-- doxytag: member="p3knet.h::p3MSS_V4" ref="014a24c9be04290b9d79a566173a0599" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3MSS_V4&nbsp;&nbsp;&nbsp;p3MSS + p3EXTRA_V4          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Minimum IPv4 segment size 
<p>Referenced by <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

</div>
</div><p>
<a class="anchor" name="7c243ece9ccfe0d4b70f20e1c4e81a30"></a><!-- doxytag: member="p3knet.h::p3EXTRA_V6" ref="7c243ece9ccfe0d4b70f20e1c4e81a30" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3EXTRA_V6&nbsp;&nbsp;&nbsp;148          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Extra buffer space needed for IPv6 P3 packet 
</div>
</div><p>
<a class="anchor" name="1ee293725b0d49e0fb622f7ebd58f4af"></a><!-- doxytag: member="p3knet.h::p3MSS_V6" ref="1ee293725b0d49e0fb622f7ebd58f4af" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3MSS_V6&nbsp;&nbsp;&nbsp;p3MSS + p3EXTRA_V6          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Minimum IPv6 segment size 
</div>
</div><p>
<a class="anchor" name="f33909afec94510a2ad20c18208190af"></a><!-- doxytag: member="p3knet.h::P3MAXROUTE" ref="f33909afec94510a2ad20c18208190af" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define P3MAXROUTE&nbsp;&nbsp;&nbsp;8          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="p3knet_8c-source.html#l00119">build_p3table()</a>, and <a class="el" href="p3knet_8c-source.html#l00060">init_p3net()</a>.</p>

</div>
</div><p>
<a class="anchor" name="51c2a0d7c585283910d74e62e8ca537d"></a><!-- doxytag: member="p3knet.h::p3PKT_SIZE" ref="51c2a0d7c585283910d74e62e8ca537d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3PKT_SIZE&nbsp;&nbsp;&nbsp;0x0000ffff          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="p3linux_8c-source.html#l00816">p3net_utils()</a>, and <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

</div>
</div><p>
<a class="anchor" name="143508142f19f1bdc4940347512c6484"></a><!-- doxytag: member="p3knet.h::p3PKT_P3SRC" ref="143508142f19f1bdc4940347512c6484" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3PKT_P3SRC&nbsp;&nbsp;&nbsp;0x00010000          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="p3knet_8c-source.html#l00633">p3_lookup()</a>, and <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

</div>
</div><p>
<a class="anchor" name="e955037f864780e67ed84ef55e342f36"></a><!-- doxytag: member="p3knet.h::p3PKT_P3DST" ref="e955037f864780e67ed84ef55e342f36" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define p3PKT_P3DST&nbsp;&nbsp;&nbsp;0x00020000          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

<p>Referenced by <a class="el" href="p3knet_8c-source.html#l00633">p3_lookup()</a>, and <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

</div>
</div><p>
<hr><h2>Typedef Documentation</h2>
<a class="anchor" name="461272c2dc749c8d1083390d51e9d617"></a><!-- doxytag: member="p3knet.h::p3route" ref="461272c2dc749c8d1083390d51e9d617" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__p3route.html">_p3route</a> <a class="el" href="struct__p3route.html">p3route</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="fde6196c28f8fb25461fc434a8374e40"></a><!-- doxytag: member="p3knet.h::p3net" ref="fde6196c28f8fb25461fc434a8374e40" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__p3net.html">_p3net</a> <a class="el" href="struct__p3net.html">p3net</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="004552a0e2c2e9846b0a3303ab69f706"></a><!-- doxytag: member="p3knet.h::p3packet" ref="004552a0e2c2e9846b0a3303ab69f706" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct <a class="el" href="struct__p3packet.html">_p3packet</a> <a class="el" href="struct__p3packet.html">p3packet</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="ebcb19f32b96fdb0c580e57088828b4a"></a><!-- doxytag: member="p3knet.h::init_p3net" ref="ebcb19f32b96fdb0c580e57088828b4a" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_p3net           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b>Function:</b></dt><dd>init_p3net</dd></dl>
<dl class="user" compact><dt><b>Description:</b></dt><dd>Initialize the network functionality.</dd></dl>
The P3 routing table is used to determine if a packet is to be encrypted and forwarded to a remote P3 system. There is a configuration file for all pre-defined remote P3 systems. However, there must be a mechanism for dynamic configurations. The requirements for this are:<ul>
<li>Administrator approval</li><li>Automation where possible</li><li>Immediate use by the remote P3 system</li></ul>
<p>
<dl class="user" compact><dt><b>Inputs:</b></dt><dd><ul>
<li>None</li></ul>
</dd></dl>
<dl class="user" compact><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status<ul>
<li>0 = OK</li><li>&lt;0 = Error </li></ul>
</li></ul>
</dd></dl>

<p>References <a class="el" href="p3knet_8h-source.html#l00056">_p3route::nets</a>, <a class="el" href="mdefs_8h-source.html#l00019">NULL</a>, <a class="el" href="p3base_8h-source.html#l00185">p3calloc</a>, <a class="el" href="p3profile_8c-source.html#l00387">p3errmsg()</a>, <a class="el" href="p3knet_8h-source.html#l00058">P3MAXROUTE</a>, and <a class="el" href="p3base_8h-source.html#l00046">p3MSG_CRIT</a>.</p>

<p>Referenced by <a class="el" href="p3kprimary_8c-source.html#l00068">init_primary()</a>, <a class="el" href="p3kprimaryplus_8c-source.html#l00068">init_primaryplus()</a>, and <a class="el" href="p3ksecondary_8c-source.html#l00066">init_secondary()</a>.</p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="p3knet_8h_ebcb19f32b96fdb0c580e57088828b4a_cgraph.png" border="0" usemap="#p3knet_8h_ebcb19f32b96fdb0c580e57088828b4a_cgraph_map" alt=""></center>
<map name="p3knet_8h_ebcb19f32b96fdb0c580e57088828b4a_cgraph_map">
<area shape="rect" href="p3profile_8c.html#115044c21fee0be99499431a0d3cabdc" title="p3errmsg" alt="" coords="140,5,223,32"></map>
</div>

</div>
</div><p>
<a class="anchor" name="477c7725aa7c5d922a3e6f4cf59c419f"></a><!-- doxytag: member="p3knet.h::build_p3table" ref="477c7725aa7c5d922a3e6f4cf59c419f" args="(p3net *net, int ipver)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int build_p3table           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__p3net.html">p3net</a> *&nbsp;</td>
          <td class="paramname"> <em>net</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ipver</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b>Function:</b></dt><dd>build_p3_table</dd></dl>
<dl class="user" compact><dt><b>Description:</b></dt><dd>Build the P3 routing table.</dd></dl>
<dl class="user" compact><dt><b>Inputs:</b></dt><dd><ul>
<li>net: A network destination for remote P3 hosts.</li><li>ipver: The IP version of the network being defined.</li></ul>
</dd></dl>
<dl class="user" compact><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status<ul>
<li>0 = OK</li><li>&lt;0 = Error</li><li>&gt;0 = Warning </li></ul>
</li></ul>
</dd></dl>

<p>References <a class="el" href="struct__p3net.html#be25dc9f35a0bfab971f90d4d700edc8">_p3net::mask</a>, <a class="el" href="struct__p3net.html#31bd369b936ae785a5b03cb8f6d9ba0a">_p3net::net</a>, <a class="el" href="p3knet_8h-source.html#l00056">_p3route::nets</a>, <a class="el" href="p3knet_8h-source.html#l00057">_p3route::netsz</a>, <a class="el" href="p3profile_8c-source.html#l00387">p3errmsg()</a>, <a class="el" href="p3net_8h-source.html#l00048">p3HST_IPV4</a>, <a class="el" href="p3knet_8h-source.html#l00058">P3MAXROUTE</a>, <a class="el" href="p3base_8h-source.html#l00051">p3MSG_DEBUG</a>, <a class="el" href="p3base_8h-source.html#l00048">p3MSG_WARN</a>, and <a class="el" href="p3net_8h-source.html#l00096">_p3net::v4</a>.</p>

<p>Referenced by <a class="el" href="p3kprimary_8c-source.html#l00134">parse_p3data()</a>.</p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="p3knet_8h_477c7725aa7c5d922a3e6f4cf59c419f_cgraph.png" border="0" usemap="#p3knet_8h_477c7725aa7c5d922a3e6f4cf59c419f_cgraph_map" alt=""></center>
<map name="p3knet_8h_477c7725aa7c5d922a3e6f4cf59c419f_cgraph_map">
<area shape="rect" href="p3profile_8c.html#115044c21fee0be99499431a0d3cabdc" title="p3errmsg" alt="" coords="161,5,244,32"></map>
</div>

</div>
</div><p>
<a class="anchor" name="f447819ecfcd4e69349a017e7d8a13cd"></a><!-- doxytag: member="p3knet.h::packet_handler" ref="f447819ecfcd4e69349a017e7d8a13cd" args="(p3packet *pkt, void *p3sys_net)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int packet_handler           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__p3packet.html">p3packet</a> *&nbsp;</td>
          <td class="paramname"> <em>pkt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void *&nbsp;</td>
          <td class="paramname"> <em>p3sys_net</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b>Function:</b></dt><dd>packet_handler</dd></dl>
<dl class="user" compact><dt><b>Description:</b></dt><dd>Determine what action to perform on an intercepted packet.</dd></dl>
<ul>
<li>If source is another P3 system, remove the ESP enhanced header<ul>
<li>Get the appropriate key and decrypt the packet<ul>
<li>If destination is this P3 system, decrypt and handle control message</li><li>Else, send the packet to the appropriate interface</li></ul>
</li></ul>
</li><li>Else, check P3 tree for destination<ul>
<li>If the destination is another P3 system<ul>
<li>If the packet is TCP SYN, make sure the MSS allows for P3 header requirements</li><li>Encrypt the packet, add the P3 header and return the packet to the stack</li></ul>
</li><li>If destination is not another P3 system, return the packet to the stack</li></ul>
</li></ul>
<p>
<dl class="user" compact><dt><b>Inputs:</b></dt><dd><ul>
<li>pkt: A p3packet structure containing information about the packet.</li><li>p3sys_net: The system network structure pointer. This is passed as void pointer and cast appropriately in the callback, p3net_utils.</li></ul>
</dd></dl>
<dl class="user" compact><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Packet status<ul>
<li>p3PKTS_NOMOD = Unmodified</li><li>p3PKTS_ADDHDR = Header added (implies encryption)</li><li>p3PKTS_RMVHDR = Header removed (implies decryption)</li><li>p3PKTS_CONTROL = Control packet handled by P3 processing</li><li>p3PKTS_RAWSOCK = Packet is establishing a Raw socket </li></ul>
</li></ul>
</dd></dl>

<p>References <a class="el" href="struct__p3sec__main.html#10d3cf16754fad672cb6d319559ec4de">_p3sec_main::addr</a>, <a class="el" href="struct__p3pri__main.html#e1477d229d77391fa692d73c6010d9ab">_p3pri_main::addr</a>, <a class="el" href="p3kcrypto_8h-source.html#l00095">_p3keymgmt::ctldec0</a>, <a class="el" href="p3kcrypto_8h-source.html#l00097">_p3keymgmt::ctldec1</a>, <a class="el" href="p3kcrypto_8h-source.html#l00091">_p3keymgmt::datdec0</a>, <a class="el" href="p3kcrypto_8h-source.html#l00093">_p3keymgmt::datdec1</a>, <a class="el" href="p3ksession_8h-source.html#l00141">_p3session::flag</a>, <a class="el" href="p3knet_8h-source.html#l00092">_p3packet::flag</a>, <a class="el" href="planning_8txt-source.html#l00002">host</a>, <a class="el" href="p3knet_8h-source.html#l00090">_p3packet::host</a>, <a class="el" href="p3ksession_8h-source.html#l00106">_p3session::keymgmt</a>, <a class="el" href="p3ksession_8h-source.html#l00163">_p3ctlmsg::len</a>, <a class="el" href="p3ksession_8h-source.html#l00124">_p3session::lock</a>, <a class="el" href="p3ksession_8h-source.html#l00162">_p3ctlmsg::message</a>, <a class="el" href="p3knet_8h-source.html#l00091">_p3packet::netdata</a>, <a class="el" href="mdefs_8h-source.html#l00019">NULL</a>, <a class="el" href="p3kcrypto_8c-source.html#l00466">p3_decrypt()</a>, <a class="el" href="p3kcrypto_8c-source.html#l00392">p3_encrypt()</a>, <a class="el" href="p3knet_8c-source.html#l00633">p3_lookup()</a>, <a class="el" href="p3primary_8c-source.html#l00074">p3buf</a>, <a class="el" href="p3ksession_8h-source.html#l00138">p3CONTROL_HDR4</a>, <a class="el" href="p3kcrypto_8h-source.html#l00023">p3CRYPTO_ALIGN</a>, <a class="el" href="p3kcrypto_8h-source.html#l00032">p3CTLDEC0</a>, <a class="el" href="p3kcrypto_8h-source.html#l00030">p3CTLDEC1</a>, <a class="el" href="p3kcrypto_8h-source.html#l00028">p3DATDEC0</a>, <a class="el" href="p3kcrypto_8h-source.html#l00026">p3DATDEC1</a>, <a class="el" href="p3kcrypto_8h-source.html#l00025">p3DATENC1</a>, <a class="el" href="p3profile_8c-source.html#l00387">p3errmsg()</a>, <a class="el" href="p3knet_8h-source.html#l00036">p3EXTRA_V4</a>, <a class="el" href="p3kbase_8h-source.html#l00130">p3free</a>, <a class="el" href="p3knet_8h-source.html#l00028">p3GET_MTU</a>, <a class="el" href="p3ksession_8h-source.html#l00134">_p3session::p3hdr</a>, <a class="el" href="p3knet_8h-source.html#l00033">p3IP4_DADDR</a>, <a class="el" href="p3knet_8h-source.html#l00031">p3IP4_ID</a>, <a class="el" href="p3linux_8h-source.html#l00072">p3lock</a>, <a class="el" href="p3base_8h-source.html#l00171">p3malloc</a>, <a class="el" href="p3base_8h-source.html#l00046">p3MSG_CRIT</a>, <a class="el" href="p3base_8h-source.html#l00051">p3MSG_DEBUG</a>, <a class="el" href="p3base_8h-source.html#l00047">p3MSG_ERR</a>, <a class="el" href="p3base_8h-source.html#l00048">p3MSG_WARN</a>, <a class="el" href="p3knet_8h-source.html#l00035">p3MSS</a>, <a class="el" href="p3knet_8h-source.html#l00037">p3MSS_V4</a>, <a class="el" href="p3linux_8c-source.html#l00816">p3net_utils()</a>, <a class="el" href="p3knet_8h-source.html#l00095">p3PKT_P3DST</a>, <a class="el" href="p3knet_8h-source.html#l00094">p3PKT_P3SRC</a>, <a class="el" href="p3knet_8h-source.html#l00093">p3PKT_SIZE</a>, <a class="el" href="p3knet_8h-source.html#l00019">p3PKTS_ADDHDR</a>, <a class="el" href="p3knet_8h-source.html#l00023">p3PKTS_CHKSUM</a>, <a class="el" href="p3knet_8h-source.html#l00021">p3PKTS_CONTROL</a>, <a class="el" href="p3knet_8h-source.html#l00022">p3PKTS_RAWSOCK</a>, <a class="el" href="p3knet_8h-source.html#l00020">p3PKTS_RMVHDR</a>, <a class="el" href="p3ksession_8h-source.html#l00143">p3PSS_ACT</a>, <a class="el" href="p3ksession_8h-source.html#l00144">p3PSS_REKEY</a>, <a class="el" href="p3ksession_8h-source.html#l00113">p3SEQ_DIFF</a>, <a class="el" href="p3ksession_8h-source.html#l00136">p3SESSION_HDR4</a>, <a class="el" href="p3linux_8h-source.html#l00065">p3SET_CHECKSUM_V4</a>, <a class="el" href="p3knet_8h-source.html#l00026">p3TCP_CHECK</a>, <a class="el" href="p3knet_8h-source.html#l00027">p3TCP_CHECK_ADD</a>, <a class="el" href="p3linux_8h-source.html#l00075">p3unlock</a>, <a class="el" href="p3knet_8h-source.html#l00089">_p3packet::packet</a>, <a class="el" href="p3ksession_8c-source.html#l00438">parse_ctl_message()</a>, <a class="el" href="p3ksession_8h-source.html#l00084">_p3host::port</a>, <a class="el" href="p3primary_8c-source.html#l00058">primain</a>, <a class="el" href="p3ksession_8h-source.html#l00114">_p3session::rID0</a>, <a class="el" href="p3ksession_8h-source.html#l00115">_p3session::rID1</a>, <a class="el" href="p3primaryplus_8c-source.html#l00041">secmain</a>, <a class="el" href="p3ksession_8h-source.html#l00077">_p3host::session</a>, <a class="el" href="p3ksession_8h-source.html#l00112">_p3session::sseq</a>, <a class="el" href="p3kprimary_8c-source.html#l00402">start_rekeying()</a>, <a class="el" href="p3ksecondary_8h-source.html#l00037">_p3sec_main::v4</a>, and <a class="el" href="p3kprimary_8h-source.html#l00044">_p3pri_main::v4</a>.</p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="p3knet_8h_f447819ecfcd4e69349a017e7d8a13cd_cgraph.png" border="0" usemap="#p3knet_8h_f447819ecfcd4e69349a017e7d8a13cd_cgraph_map" alt=""></center>
<map name="p3knet_8h_f447819ecfcd4e69349a017e7d8a13cd_cgraph_map">
<area shape="rect" href="p3kcrypto_8c.html#3285d40d28100b2efe0ca06b8d00b2f8" title="p3_decrypt" alt="" coords="815,56,905,83"><area shape="rect" href="p3profile_8c.html#115044c21fee0be99499431a0d3cabdc" title="p3errmsg" alt="" coords="1444,284,1527,311"><area shape="rect" href="p3kcrypto_8c.html#e807e42de382b4967dcf61a94abf1d63" title="p3_encrypt" alt="" coords="815,107,905,133"><area shape="rect" href="p3knet_8c.html#7d8e3f552c7187072e555bf504fec819" title="p3_lookup" alt="" coords="1031,259,1116,285"><area shape="rect" href="p3linux_8c.html#61e0f4c4c3ee65ef0c0c47c5766d25fc" title="p3net_utils" alt="" coords="815,233,905,260"><area shape="rect" href="p3ksession_8c.html#ccd384ee6eff17fb46a44bcd0a2e8ed9" title="parse_ctl_message" alt="" coords="175,537,319,564"><area shape="rect" href="p3kprimary_8c.html#03d79b6ee63bc63762cdea330216b2d9" title="start_rekeying" alt="" coords="191,259,303,285"><area shape="rect" href="aes_8c.html#0773743fae8155fec8bf75c087531364" title="DoAES" alt="" coords="1041,157,1105,184"><area shape="rect" href="merrors_8c.html#e0fbf1c8cf3bc5beb2c222ef6fb403e2" title="MERROR_lookUpErrorCode" alt="" coords="979,107,1168,133"><area shape="rect" href="aes_8h.html#b00b50ef06bf8b54ce973618804586e2" title="AESALGO_blockDecrypt" alt="" coords="1216,5,1389,32"><area shape="rect" href="aes_8h.html#5c1fa1647ea06de25b72db0239129de6" title="AESALGO_blockEncrypt" alt="" coords="1217,56,1388,83"><area shape="rect" href="aesalgo_8c.html#4c719df4534cebdf4a32e36b2baeeaf8" title="aesDecrypt" alt="" coords="1439,5,1532,32"><area shape="rect" href="aesalgo_8c.html#ab1010e729d5c019e6ef9e4dd55a3b96" title="aesEncrypt" alt="" coords="1440,56,1531,83"><area shape="rect" href="p3kpri__session_8c.html#9bb8f1ec82fa429ae11637caa19bf1f5" title="heartbeat_answer" alt="" coords="387,512,523,539"><area shape="rect" href="p3ksec__session_8c.html#11bf297973fd2df2fb5da58abc220f3e" title="heartbeat_query" alt="" coords="391,563,519,589"><area shape="rect" href="p3kpri__session_8c.html#ca3d48d1ee35eb9d228250606f4394c3" title="key_array_error" alt="" coords="395,664,515,691"><area shape="rect" href="p3kpri__session_8c.html#52a21487fa0fd6103b29853aa2152f58" title="rekey_session" alt="" coords="399,360,511,387"><area shape="rect" href="p3kpri__session_8c.html#1e7a96342264a49601111f552b6b0219" title="rekey_test_pri" alt="" coords="609,576,721,603"><area shape="rect" href="p3ksec__session_8c.html#52262f83863e788f79c32917699172be" title="rekey_test_sec" alt="" coords="396,411,513,437"><area shape="rect" href="p3ksec__session_8c.html#2cee32c0152fbe0cb76c0739d0c72246" title="replace_key" alt="" coords="407,765,503,792"><area shape="rect" href="p3ksec__session_8c.html#6630ebbd7b47ed8338e449d26f9958ec" title="set_key_array" alt="" coords="400,461,509,488"><area shape="rect" href="p3ksession_8c.html#4a5a8ada1f7c67ee101fd8f2865b8436" title="build_vlen_message" alt="" coords="591,715,740,741"><area shape="rect" href="p3knet_8c.html#e42b8ad940d0e2e7f53e7e4096934645" title="p3send_control" alt="" coords="605,309,725,336"><area shape="rect" href="p3ksession_8c.html#594393343fee6c7a0fc9c6d7fc6ba265" title="build_ctl_message" alt="" coords="791,664,929,691"><area shape="rect" href="p3ksession_8h.html#82ba0db0ef7ddf7e28cc28fab0761aa3" title="build_newkey_message" alt="" coords="369,259,540,285"></map>
</div>

</div>
</div><p>
<a class="anchor" name="7d8e3f552c7187072e555bf504fec819"></a><!-- doxytag: member="p3knet.h::p3_lookup" ref="7d8e3f552c7187072e555bf504fec819" args="(p3packet *pkt)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void p3_lookup           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__p3packet.html">p3packet</a> *&nbsp;</td>
          <td class="paramname"> <em>pkt</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b>Function:</b></dt><dd>p3_lookup</dd></dl>
<dl class="user" compact><dt><b>Description:</b></dt><dd>Lookup the IP addresses of a packet in the P3 routing tables.</dd></dl>
<dl class="user" compact><dt><b>Inputs:</b></dt><dd><ul>
<li>pkt: A p3packet structure containing information about the packet.</li></ul>
</dd></dl>
<dl class="user" compact><dt><b>Outputs:</b></dt><dd><ul>
<li>p3host *: Remote P3 host structure where<ul>
<li>NULL: Not found in P3 route table</li><li>Structure pointer bit 0:<ul>
<li>0 = Source is a P3 host</li><li>1 = Destination is a P3 network<ul>
<li><em>Note that this bit must be cleared by the caller</em> </li></ul>
</li></ul>
</li></ul>
</li></ul>
</dd></dl>

<p>References <a class="el" href="struct__p3host.html#1d30157fd8630192bcadb18c25dacd9f">_p3host::addr</a>, <a class="el" href="struct__p3sec__main.html#10d3cf16754fad672cb6d319559ec4de">_p3sec_main::addr</a>, <a class="el" href="struct__p3pri__main.html#e1477d229d77391fa692d73c6010d9ab">_p3pri_main::addr</a>, <a class="el" href="p3knet_8h-source.html#l00092">_p3packet::flag</a>, <a class="el" href="p3ksession_8h-source.html#l00076">_p3host::hlist</a>, <a class="el" href="p3knet_8h-source.html#l00077">_p3net::host</a>, <a class="el" href="p3knet_8h-source.html#l00090">_p3packet::host</a>, <a class="el" href="struct__p3net.html#be25dc9f35a0bfab971f90d4d700edc8">_p3net::mask</a>, <a class="el" href="struct__p3net.html#31bd369b936ae785a5b03cb8f6d9ba0a">_p3net::net</a>, <a class="el" href="p3knet_8h-source.html#l00056">_p3route::nets</a>, <a class="el" href="p3knet_8h-source.html#l00057">_p3route::netsz</a>, <a class="el" href="mdefs_8h-source.html#l00019">NULL</a>, <a class="el" href="p3profile_8c-source.html#l00387">p3errmsg()</a>, <a class="el" href="p3base_8h-source.html#l00047">p3MSG_ERR</a>, <a class="el" href="p3knet_8h-source.html#l00095">p3PKT_P3DST</a>, <a class="el" href="p3knet_8h-source.html#l00094">p3PKT_P3SRC</a>, <a class="el" href="p3knet_8h-source.html#l00089">_p3packet::packet</a>, <a class="el" href="p3primary_8c-source.html#l00058">primain</a>, <a class="el" href="p3primaryplus_8c-source.html#l00041">secmain</a>, <a class="el" href="p3net_8h-source.html#l00096">_p3net::v4</a>, <a class="el" href="p3net_8h-source.html#l00037">_p3host::v4</a>, <a class="el" href="p3ksecondary_8h-source.html#l00037">_p3sec_main::v4</a>, and <a class="el" href="p3kprimary_8h-source.html#l00044">_p3pri_main::v4</a>.</p>

<p>Referenced by <a class="el" href="p3knet_8c-source.html#l00198">packet_handler()</a>.</p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="p3knet_8h_7d8e3f552c7187072e555bf504fec819_cgraph.png" border="0" usemap="#p3knet_8h_7d8e3f552c7187072e555bf504fec819_cgraph_map" alt=""></center>
<map name="p3knet_8h_7d8e3f552c7187072e555bf504fec819_cgraph_map">
<area shape="rect" href="p3profile_8c.html#115044c21fee0be99499431a0d3cabdc" title="p3errmsg" alt="" coords="143,5,225,32"></map>
</div>

</div>
</div><p>
<a class="anchor" name="aea152b37791da68ffdf7029305935dc"></a><!-- doxytag: member="p3knet.h::encrypt_packet" ref="aea152b37791da68ffdf7029305935dc" args="(p3session *p3sess, unsigned char *packet)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char* encrypt_packet           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__p3session.html">p3session</a> *&nbsp;</td>
          <td class="paramname"> <em>p3sess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>packet</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="70f83668afef962d8ca62ab415899cc0"></a><!-- doxytag: member="p3knet.h::decrypt_packet" ref="70f83668afef962d8ca62ab415899cc0" args="(p3session *p3sess, unsigned char *packet)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">unsigned char* decrypt_packet           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__p3session.html">p3session</a> *&nbsp;</td>
          <td class="paramname"> <em>p3sess</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>packet</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="e42b8ad940d0e2e7f53e7e4096934645"></a><!-- doxytag: member="p3knet.h::p3send_control" ref="e42b8ad940d0e2e7f53e7e4096934645" args="(p3session *session, p3ctlmsg *cmsg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int p3send_control           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__p3session.html">p3session</a> *&nbsp;</td>
          <td class="paramname"> <em>session</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct__p3ctlmsg.html">p3ctlmsg</a> *&nbsp;</td>
          <td class="paramname"> <em>cmsg</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b>Function:</b></dt><dd>p3send_control</dd></dl>
<dl class="user" compact><dt><b>Description:</b></dt><dd>Build a control message and send it to a remote P3 host. All encryption is performed in this function. The packet format consists of the following:</dd></dl>
<pre>
     P3 Header      P3 Ctl Header     Control Message
                                     |---Encrypted---|
                  |------------Encrypted-------------|
 IP Hdr + ESP Hdr  IP Hdr + UDP Hdr   Control Message
 </pre><p>
<b><em>Note that the control message is freed in this function.</em></b><p>
<dl class="user" compact><dt><b>Inputs:</b></dt><dd><ul>
<li>session: The remote host session structure</li><li>cmsg: The control message to be sent</li></ul>
</dd></dl>
<dl class="user" compact><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status:<ul>
<li>0: OK</li><li>&lt;0: Error </li></ul>
</li></ul>
</dd></dl>

<p>References <a class="el" href="p3knet_8h-source.html#l00092">_p3packet::flag</a>, <a class="el" href="p3knet_8h-source.html#l00090">_p3packet::host</a>, <a class="el" href="p3ksession_8h-source.html#l00105">_p3session::host</a>, <a class="el" href="p3ksession_8h-source.html#l00106">_p3session::keymgmt</a>, <a class="el" href="p3ksession_8h-source.html#l00163">_p3ctlmsg::len</a>, <a class="el" href="p3ksession_8h-source.html#l00124">_p3session::lock</a>, <a class="el" href="p3ksession_8h-source.html#l00162">_p3ctlmsg::message</a>, <a class="el" href="mdefs_8h-source.html#l00019">NULL</a>, <a class="el" href="p3kcrypto_8c-source.html#l00392">p3_encrypt()</a>, <a class="el" href="p3primary_8c-source.html#l00074">p3buf</a>, <a class="el" href="p3ksession_8h-source.html#l00138">p3CONTROL_HDR4</a>, <a class="el" href="p3kcrypto_8h-source.html#l00029">p3CTLENC1</a>, <a class="el" href="p3kcrypto_8h-source.html#l00025">p3DATENC1</a>, <a class="el" href="p3profile_8c-source.html#l00387">p3errmsg()</a>, <a class="el" href="p3kbase_8h-source.html#l00130">p3free</a>, <a class="el" href="p3ksession_8h-source.html#l00134">_p3session::p3hdr</a>, <a class="el" href="p3linux_8h-source.html#l00072">p3lock</a>, <a class="el" href="p3base_8h-source.html#l00171">p3malloc</a>, <a class="el" href="p3base_8h-source.html#l00046">p3MSG_CRIT</a>, <a class="el" href="p3base_8h-source.html#l00051">p3MSG_DEBUG</a>, <a class="el" href="p3linux_8c-source.html#l00816">p3net_utils()</a>, <a class="el" href="p3knet_8h-source.html#l00029">p3SEND_CTL</a>, <a class="el" href="p3ksession_8h-source.html#l00113">p3SEQ_DIFF</a>, <a class="el" href="p3ksession_8h-source.html#l00136">p3SESSION_HDR4</a>, <a class="el" href="p3linux_8h-source.html#l00065">p3SET_CHECKSUM_V4</a>, <a class="el" href="p3linux_8h-source.html#l00075">p3unlock</a>, <a class="el" href="p3knet_8h-source.html#l00089">_p3packet::packet</a>, <a class="el" href="p3ksession_8h-source.html#l00084">_p3host::port</a>, and <a class="el" href="p3ksession_8h-source.html#l00112">_p3session::sseq</a>.</p>

<p>Referenced by <a class="el" href="p3kpri__session_8c-source.html#l00096">rekey_session()</a>, <a class="el" href="p3ksec__session_8c-source.html#l00103">replace_key()</a>, and <a class="el" href="p3kprimary_8c-source.html#l00402">start_rekeying()</a>.</p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="p3knet_8h_e42b8ad940d0e2e7f53e7e4096934645_cgraph.png" border="0" usemap="#p3knet_8h_e42b8ad940d0e2e7f53e7e4096934645_cgraph_map" alt=""></center>
<map name="p3knet_8h_e42b8ad940d0e2e7f53e7e4096934645_cgraph_map">
<area shape="rect" href="p3kcrypto_8c.html#e807e42de382b4967dcf61a94abf1d63" title="p3_encrypt" alt="" coords="175,48,265,75"><area shape="rect" href="p3profile_8c.html#115044c21fee0be99499431a0d3cabdc" title="p3errmsg" alt="" coords="780,124,863,151"><area shape="rect" href="p3linux_8c.html#61e0f4c4c3ee65ef0c0c47c5766d25fc" title="p3net_utils" alt="" coords="175,99,265,125"><area shape="rect" href="aes_8c.html#0773743fae8155fec8bf75c087531364" title="DoAES" alt="" coords="377,149,441,176"><area shape="rect" href="merrors_8c.html#e0fbf1c8cf3bc5beb2c222ef6fb403e2" title="MERROR_lookUpErrorCode" alt="" coords="315,23,504,49"><area shape="rect" href="aes_8h.html#b00b50ef06bf8b54ce973618804586e2" title="AESALGO_blockDecrypt" alt="" coords="552,225,725,252"><area shape="rect" href="aes_8h.html#5c1fa1647ea06de25b72db0239129de6" title="AESALGO_blockEncrypt" alt="" coords="553,175,724,201"><area shape="rect" href="aesalgo_8c.html#4c719df4534cebdf4a32e36b2baeeaf8" title="aesDecrypt" alt="" coords="775,225,868,252"><area shape="rect" href="aesalgo_8c.html#ab1010e729d5c019e6ef9e4dd55a3b96" title="aesEncrypt" alt="" coords="776,175,867,201"></map>
</div>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="c23de86e4ad7c3a7fa624b9a8c1c2b56"></a><!-- doxytag: member="p3knet.h::ipv4route" ref="c23de86e4ad7c3a7fa624b9a8c1c2b56" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct__p3route.html">p3route</a>* <a class="el" href="p3knet_8h.html#c23de86e4ad7c3a7fa624b9a8c1c2b56">ipv4route</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The primary P3 route tables 
</div>
</div><p>
<a class="anchor" name="b0ef994e33f019f8ff1da7b214cab5f3"></a><!-- doxytag: member="p3knet.h::ipv6route" ref="b0ef994e33f019f8ff1da7b214cab5f3" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct__p3route.html">p3route</a> * <a class="el" href="p3knet_8h.html#b0ef994e33f019f8ff1da7b214cab5f3">ipv6route</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<a class="anchor" name="b0ef672ac9ffe9efaff389eae79bbcd9"></a><!-- doxytag: member="p3knet.h::p3hosts" ref="b0ef672ac9ffe9efaff389eae79bbcd9" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct__p3host.html">p3host</a>* <a class="el" href="p3knet_8h.html#b0ef672ac9ffe9efaff389eae79bbcd9">p3hosts</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The remote host table 
<p>Referenced by <a class="el" href="p3kprimary_8c-source.html#l00134">parse_p3data()</a>.</p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Sep 24 10:44:29 2010 for Velocite Systems Protected Point to Point Solution by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
