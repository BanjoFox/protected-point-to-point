<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Velocite Systems Protected Point to Point Solution: p3sec_session.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>p3sec_session.c File Reference</h1><code>#include &quot;<a class="el" href="p3session_8h_source.html">p3session.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="p3secondary_8h_source.html">p3secondary.h</a>&quot;</code><br/>
<div class="dynheader">
Include dependency graph for p3sec_session.c:</div>
<div class="dynsection">
</div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3sec__session_8c.html#af995b1ee97f9e12071abb6ef9cfa8d33">_p3SEC_SS_C</a></td></tr>
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3sec__session_8c.html#ad1fe2c10e0ea71c8714a626a46d60daf">init_sec_session</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3sec__session_8c.html#a552e186651a9de0f8cdc8104e71e8597">sec_session_manager</a> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3sec__session_8c.html#a019a4d1e2c7fee5745409f77863afe94">set_key_array</a> (unsigned char *message, int ksize, int dsize)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3sec__session_8c.html#a5e7b0c0c7c098b369f449889ed766666">replace_key_index</a> (int type, int index)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3sec__session_8c.html#a49abb8496f26018e75b7048dfb9ac28e">replace_key</a> (int type, unsigned char *key, int klen)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3sec__session_8c.html#a836f2a2f279e6a21152ef0baeb58e674">rekey_session</a> (unsigned int key_num)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3sec__session_8c.html#a12cfa395e96beaa00e49b7712ca1a29b">rekey_test_sec</a> (unsigned char *message, int size)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3sec__session_8c.html#a9d7e3e02a08fef64db8d03098e5b0872">heartbeat_query</a> (int sec, int subsec, unsigned int seqnum)</td></tr>
<tr><td colspan="2"><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="struct__p3session.html">p3session</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3sec__session_8c.html#af01e1812f2bb3a71e6bdf3a19a4120f8">p3sess</a></td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h3>Protected Point to Point secondary session</h3>
<p>Copyright (C) Velocite 2010</p>
<p>The secondary user session manages communications with primary P3 systems. </p>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="af995b1ee97f9e12071abb6ef9cfa8d33"></a><!-- doxytag: member="p3sec_session.c::_p3SEC_SS_C" ref="af995b1ee97f9e12071abb6ef9cfa8d33" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _p3SEC_SS_C</td>
        </tr>
      </table>
</div>
<div class="memdoc">

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ad1fe2c10e0ea71c8714a626a46d60daf"></a><!-- doxytag: member="p3sec_session.c::init_sec_session" ref="ad1fe2c10e0ea71c8714a626a46d60daf" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_sec_session </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="user"><dt><b>Function:</b></dt><dd>init_sec_session</dd></dl>
<dl class="user"><dt><b>Description:</b></dt><dd>Initialize the secondary to primary session.</dd></dl>
<dl class="user"><dt><b>Inputs:</b></dt><dd><ul>
<li>None</li>
</ul>
</dd></dl>
<dl class="user"><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status<ul>
<li>0 = OK</li>
<li>&lt;0 = Error </li>
</ul>
</li>
</ul>
</dd></dl>

<p>References <a class="el" href="p3primary_8c_source.html#l00061">p3buf</a>, <a class="el" href="p3base_8h_source.html#l00165">p3calloc</a>, <a class="el" href="p3utils_8c_source.html#l00090">p3errmsg()</a>, and <a class="el" href="p3base_8h_source.html#l00040">p3MSG_CRIT</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<div class="center"><img src="p3sec__session_8c_ad1fe2c10e0ea71c8714a626a46d60daf_cgraph.png" border="0" usemap="#p3sec__session_8c_ad1fe2c10e0ea71c8714a626a46d60daf_cgraph_map" alt=""></div>
</div>
</p>

</div>
</div>
<a class="anchor" id="a552e186651a9de0f8cdc8104e71e8597"></a><!-- doxytag: member="p3sec_session.c::sec_session_manager" ref="a552e186651a9de0f8cdc8104e71e8597" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sec_session_manager </td>
          <td>(</td>
          <td class="paramname"></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="user"><dt><b>Function:</b></dt><dd>session_manager</dd></dl>
<dl class="user"><dt><b>Description:</b></dt><dd>Manage the secondary to secondary session.</dd></dl>
<p>NOTE: If implemented as a continuous child process, see sendmsg, recvmsg, and cmsg for passing socket file descriptors.</p>
<dl class="user"><dt><b>Inputs:</b></dt><dd><ul>
<li>None</li>
</ul>
</dd></dl>
<dl class="user"><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status<ul>
<li>0 = OK</li>
<li>&lt;0 = Error </li>
</ul>
</li>
</ul>
</dd></dl>

</div>
</div>
<a class="anchor" id="a019a4d1e2c7fee5745409f77863afe94"></a><!-- doxytag: member="p3sec_session.c::set_key_array" ref="a019a4d1e2c7fee5745409f77863afe94" args="(unsigned char *message, int ksize, int dsize)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int set_key_array </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>ksize</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>dsize</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="user"><dt><b>Function:</b></dt><dd>set_key_array</dd></dl>
<dl class="user"><dt><b>Description:</b></dt><dd>Receive an array of keys from the primary. The secondary stores these in an array for when an index is used to indicate the key replacement.</dd></dl>
<dl class="user"><dt><b>Inputs:</b></dt><dd><ul>
<li>None</li>
</ul>
</dd></dl>
<dl class="user"><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status (see the errors for the p3CMSG_ACK_KEY_ARRAY field) </li>
</ul>
</dd></dl>

<p>Referenced by <a class="el" href="p3session_8c_source.html#l00103">recv_ctl_message()</a>.</p>

</div>
</div>
<a class="anchor" id="a5e7b0c0c7c098b369f449889ed766666"></a><!-- doxytag: member="p3sec_session.c::replace_key_index" ref="a5e7b0c0c7c098b369f449889ed766666" args="(int type, int index)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int replace_key_index </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>index</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="user"><dt><b>Function:</b></dt><dd>replace_key_index</dd></dl>
<dl class="user"><dt><b>Description:</b></dt><dd>Replace a key using an index into the key array.</dd></dl>
<dl class="user"><dt><b>Inputs:</b></dt><dd><ul>
<li>type: The type of key to be replaced:<ul>
<li>Data</li>
<li>Control</li>
</ul>
</li>
</ul>
</dd></dl>
<dl class="user"><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status (see the errors for the p3CMSG_KEY_STATUS field) </li>
</ul>
</dd></dl>

<p>Referenced by <a class="el" href="p3session_8c_source.html#l00103">recv_ctl_message()</a>.</p>

</div>
</div>
<a class="anchor" id="a49abb8496f26018e75b7048dfb9ac28e"></a><!-- doxytag: member="p3sec_session.c::replace_key" ref="a49abb8496f26018e75b7048dfb9ac28e" args="(int type, unsigned char *key, int klen)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int replace_key </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>klen</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="user"><dt><b>Function:</b></dt><dd>replace_key</dd></dl>
<dl class="user"><dt><b>Description:</b></dt><dd>Replace a key from the primary using the key sent in the message.</dd></dl>
<dl class="user"><dt><b>Inputs:</b></dt><dd><ul>
<li>type: The type of key to be replaced:<ul>
<li>Data</li>
<li>Control</li>
</ul>
</li>
<li>key: The key contained in the message</li>
<li>klen: The length of the key</li>
</ul>
</dd></dl>
<dl class="user"><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status (see the errors for the p3CMSG_KEY_STATUS field) </li>
</ul>
</dd></dl>

<p>Referenced by <a class="el" href="p3session_8c_source.html#l00103">recv_ctl_message()</a>.</p>

</div>
</div>
<a class="anchor" id="a836f2a2f279e6a21152ef0baeb58e674"></a><!-- doxytag: member="p3sec_session.c::rekey_session" ref="a836f2a2f279e6a21152ef0baeb58e674" args="(unsigned int key_num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void rekey_session </td>
          <td>(</td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>key_num</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="user"><dt><b>Function:</b></dt><dd>rekey_session</dd></dl>
<dl class="user"><dt><b>Description:</b></dt><dd>Start using a replacement key from the primary.</dd></dl>
<dl class="user"><dt><b>Inputs:</b></dt><dd><ul>
<li>key_num: The packet ID of the first packet to use the new key</li>
</ul>
</dd></dl>
<dl class="user"><dt><b>Outputs:</b></dt><dd><ul>
<li>None </li>
</ul>
</dd></dl>

<p>Referenced by <a class="el" href="p3session_8c_source.html#l00103">recv_ctl_message()</a>.</p>

</div>
</div>
<a class="anchor" id="a12cfa395e96beaa00e49b7712ca1a29b"></a><!-- doxytag: member="p3sec_session.c::rekey_test_sec" ref="a12cfa395e96beaa00e49b7712ca1a29b" args="(unsigned char *message, int size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int rekey_test_sec </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="user"><dt><b>Function:</b></dt><dd>rekey_test_sec</dd></dl>
<dl class="user"><dt><b>Description:</b></dt><dd>Receive a message from the primary, reverse it and resend it.</dd></dl>
<dl class="user"><dt><b>Inputs:</b></dt><dd><ul>
<li>message: The message from the primary</li>
<li>size: The size of the message</li>
</ul>
</dd></dl>
<dl class="user"><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status<ul>
<li>0 = OK</li>
<li>&lt;0 = Error </li>
</ul>
</li>
</ul>
</dd></dl>

<p>Referenced by <a class="el" href="p3session_8c_source.html#l00103">recv_ctl_message()</a>.</p>

</div>
</div>
<a class="anchor" id="a9d7e3e02a08fef64db8d03098e5b0872"></a><!-- doxytag: member="p3sec_session.c::heartbeat_query" ref="a9d7e3e02a08fef64db8d03098e5b0872" args="(int sec, int subsec, unsigned int seqnum)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int heartbeat_query </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>sec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>subsec</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned int&nbsp;</td>
          <td class="paramname"> <em>seqnum</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="user"><dt><b>Function:</b></dt><dd>heartbeat_query</dd></dl>
<dl class="user"><dt><b>Description:</b></dt><dd>Handle a heartbeat query message from a primary.</dd></dl>
<dl class="user"><dt><b>Inputs:</b></dt><dd><ul>
<li>sec: The number of seconds after midnight the message was sent</li>
<li>subsec: The sub second time the message was sent</li>
<li>seqnum: The sequence number of the query</li>
</ul>
</dd></dl>
<dl class="user"><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status<ul>
<li>0 = OK</li>
<li>&lt;0 = Error </li>
</ul>
</li>
</ul>
</dd></dl>

<p>Referenced by <a class="el" href="p3session_8c_source.html#l00103">recv_ctl_message()</a>.</p>

</div>
</div>
<hr/><h2>Variable Documentation</h2>
<a class="anchor" id="af01e1812f2bb3a71e6bdf3a19a4120f8"></a><!-- doxytag: member="p3sec_session.c::p3sess" ref="af01e1812f2bb3a71e6bdf3a19a4120f8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct__p3session.html">p3session</a>* <a class="el" href="p3session_8h.html#af01e1812f2bb3a71e6bdf3a19a4120f8">p3sess</a></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<p>Global variable usage </p>

</div>
</div>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 1 13:24:48 2010 for Velocite Systems Protected Point to Point Solution by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
