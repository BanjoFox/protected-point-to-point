<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<title>Velocite Systems Protected Point to Point Solution: p3session.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<!-- Generated by Doxygen 1.6.3 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>p3session.c File Reference</h1><code>#include &quot;<a class="el" href="p3session_8h_source.html">p3session.h</a>&quot;</code><br/>
<div class="dynheader">
Include dependency graph for p3session.c:</div>
<div class="dynsection">
</div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td colspan="2"><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3session_8c.html#ab9736b0cd8825c593ed38263618b322c">send_ctl_message</a> (int type, unsigned char *message, int len, <a class="el" href="struct__p3session.html">p3session</a> *<a class="el" href="p3session_8h.html#af01e1812f2bb3a71e6bdf3a19a4120f8">p3sess</a>)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3session_8c.html#a143d81d2c62956d2455749a1142384ea">recv_ctl_message</a> (unsigned char *message)</td></tr>
</table>
<hr/><a name="_details"></a><h2>Detailed Description</h2>
<h3>Protected Point to Point primary session</h3>
<p>Copyright (C) Velocite 2010</p>
<p>The primary user session manages communications with secondary P3 systems. </p>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ab9736b0cd8825c593ed38263618b322c"></a><!-- doxytag: member="p3session.c::send_ctl_message" ref="ab9736b0cd8825c593ed38263618b322c" args="(int type, unsigned char *message, int len, p3session *p3sess)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int send_ctl_message </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>message</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="struct__p3session.html">p3session</a> *&nbsp;</td>
          <td class="paramname"> <em>p3sess</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="user"><dt><b>Function:</b></dt><dd>send_ctl_message</dd></dl>
<dl class="user"><dt><b>Description:</b></dt><dd>Manage the primary to secondary session.</dd></dl>
<p>NOTE: If implemented as a continuous child process, see sendmsg, recvmsg, and cmsg for passing socket file descriptors.</p>
<dl class="user"><dt><b>Inputs:</b></dt><dd><ul>
<li>type: P3 control message type</li>
<li>message: Message data</li>
<li>len: Length of message data</li>
<li>sess: Session structure</li>
</ul>
</dd></dl>
<dl class="user"><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status<ul>
<li>0 = OK</li>
<li>&lt;0 = Error </li>
</ul>
</li>
</ul>
</dd></dl>

<p>References <a class="el" href="p3session_8h_source.html#l00090">_p3session::ctlhdr</a>, <a class="el" href="p3session_8h_source.html#l00091">_p3session::hdrlen</a>, and <a class="el" href="p3base_8h_source.html#l00151">p3malloc</a>.</p>

</div>
</div>
<a class="anchor" id="a143d81d2c62956d2455749a1142384ea"></a><!-- doxytag: member="p3session.c::recv_ctl_message" ref="a143d81d2c62956d2455749a1142384ea" args="(unsigned char *message)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int recv_ctl_message </td>
          <td>(</td>
          <td class="paramtype">unsigned char *&nbsp;</td>
          <td class="paramname"> <em>message</em></td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="user"><dt><b>Function:</b></dt><dd>recv_ctl_message</dd></dl>
<dl class="user"><dt><b>Description:</b></dt><dd>Parse a message and call the function to handle it. The format of the Control Messages is: <pre>
 | 4 octets | 1 octet | Variable length |
 | Size     | Command | Data            |
   where the fields are:
 Size:  The total size of the message, including the size field itself
 Command:  An 8-bit number
 Data:  The data, if any, associated with the command
 </pre></dd></dl>
<p>The handler functions must be defined in the primary or secondary session handler, depending on which receives the message. The message handling code is only compiled if the P3 system is the receiver. All message handling is compiled for the Primary Plus Secondary P3 system.</p>
<p>See the P3 System Specification for details on the commands.</p>
<dl class="user"><dt><b>Inputs:</b></dt><dd><ul>
<li>message: The full message buffer including the size field.</li>
</ul>
</dd></dl>
<dl class="user"><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status<ul>
<li>0 = OK</li>
<li>&lt;0 = Error</li>
<li>&gt;0 = Status from remote P3 system </li>
</ul>
</li>
</ul>
</dd></dl>

<p>References <a class="el" href="p3pri__session_8c_source.html#l00166">heartbeat_answer()</a>, <a class="el" href="p3sec__session_8c_source.html#l00249">heartbeat_query()</a>, <a class="el" href="p3pri__session_8c_source.html#l00096">key_array_error()</a>, <a class="el" href="p3session_8h_source.html#l00029">p3CMSG_ACK_KEY_ARRAY</a>, <a class="el" href="p3session_8h_source.html#l00062">p3CMSG_ACK_SHUTDOWN</a>, <a class="el" href="p3session_8h_source.html#l00054">p3CMSG_ACK_UPDATE</a>, <a class="el" href="p3session_8h_source.html#l00032">p3CMSG_AKERR</a>, <a class="el" href="p3session_8h_source.html#l00048">p3CMSG_HRTBEAT_ANSWER</a>, <a class="el" href="p3session_8h_source.html#l00047">p3CMSG_HRTBEAT_QUERY</a>, <a class="el" href="p3session_8h_source.html#l00038">p3CMSG_KEY_STATUS</a>, <a class="el" href="p3session_8h_source.html#l00036">p3CMSG_KRCIDX</a>, <a class="el" href="p3session_8h_source.html#l00035">p3CMSG_KRDIDX</a>, <a class="el" href="p3session_8h_source.html#l00043">p3CMSG_KSERR</a>, <a class="el" href="p3session_8h_source.html#l00027">p3CMSG_KTYPE</a>, <a class="el" href="p3session_8h_source.html#l00045">p3CMSG_REKEY</a>, <a class="el" href="p3session_8h_source.html#l00046">p3CMSG_REKEY_TEST</a>, <a class="el" href="p3session_8h_source.html#l00034">p3CMSG_REPLACE_KEY</a>, <a class="el" href="p3session_8h_source.html#l00028">p3CMSG_SET_KEY_ARRAY</a>, <a class="el" href="p3session_8h_source.html#l00059">p3CMSG_SHUTDOWN</a>, <a class="el" href="p3session_8h_source.html#l00049">p3CMSG_STATUS_REQ</a>, <a class="el" href="p3session_8h_source.html#l00050">p3CMSG_STATUS_RESP</a>, <a class="el" href="p3session_8h_source.html#l00051">p3CMSG_UPDATE_INFO</a>, <a class="el" href="p3session_8h_source.html#l00021">p3KSIZE_AES128</a>, <a class="el" href="p3session_8h_source.html#l00023">p3KSIZE_AES256</a>, <a class="el" href="p3session_8h_source.html#l00020">p3KTYPE_AES128</a>, <a class="el" href="p3session_8h_source.html#l00022">p3KTYPE_AES256</a>, <a class="el" href="p3session_8h_source.html#l00025">p3STYPE_CTL</a>, <a class="el" href="p3session_8h_source.html#l00024">p3STYPE_DATA</a>, <a class="el" href="p3sec__session_8c_source.html#l00196">rekey_session()</a>, <a class="el" href="p3pri__session_8c_source.html#l00141">rekey_test_pri()</a>, <a class="el" href="p3sec__session_8c_source.html#l00222">rekey_test_sec()</a>, <a class="el" href="p3sec__session_8c_source.html#l00173">replace_key()</a>, <a class="el" href="p3pri__session_8c_source.html#l00116">replace_key_error()</a>, <a class="el" href="p3sec__session_8c_source.html#l00146">replace_key_index()</a>, and <a class="el" href="p3sec__session_8c_source.html#l00121">set_key_array()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
</div>
</p>

</div>
</div>
</div>
<hr class="footer"/><address style="text-align: right;"><small>Generated on Thu Apr 1 13:24:48 2010 for Velocite Systems Protected Point to Point Solution by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.6.3 </small></address>
</body>
</html>
