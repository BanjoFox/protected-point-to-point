<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Velocite Systems Protected Point to Point Solution: p3secondary.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>p3secondary.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
<h3>Protected Point to Point main secondary file</h3>
<p>
Copyright (C) Velocite 2010<p>
The Velocite Systems Protected Point to Point (P3) Secondary system is the client end point in a virtual point to point connection over the Internet. It requests a connections from a primary P3 system, and when a request is accepted, establishes an IPSec encrypted session. <p>
When an encrypted Data session is established, an encrypted Control session which is tunneled through the main session is established. This is immediately used to set new encryption keys for both the Data and Control sessions. <p>
All runtime administration is performed from the primary P3 system. The user interface for initial setup is interactive from the command line. 
<p>
<code>#include &quot;<a class="el" href="p3secondary_8h-source.html">p3secondary.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="p3sec__key__handler_8h-source.html">p3sec_key_handler.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="p3sec__ui_8h-source.html">p3sec_ui.h</a>&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for p3secondary.c:</div>
<div class="dynsection">
<p><center><img src="p3secondary_8c__incl.png" border="0" usemap="#p3secondary.c_map" alt=""></center>
<map name="p3secondary.c_map">
<area shape="rect" href="p3secondary_8h.html" title="p3secondary.h" alt="" coords="432,84,544,111"><area shape="rect" href="p3sec__key__handler_8h.html" title="p3sec_key_handler.h" alt="" coords="568,84,723,111"><area shape="rect" href="p3sec__ui_8h.html" title="p3sec_ui.h" alt="" coords="747,84,835,111"><area shape="rect" href="p3base_8h.html" title="p3base.h" alt="" coords="701,239,781,265"><area shape="rect" href="p3utils_8h.html" title="p3utils.h" alt="" coords="359,161,433,188"><area shape="rect" href="p3net_8h.html" title="p3net.h" alt="" coords="465,161,535,188"><area shape="rect" href="p3share_8h.html" title="p3share.h" alt="" coords="237,161,323,188"><area shape="rect" href="p3crypto_8h.html" title="p3crypto.h" alt="" coords="109,239,197,265"></map>
</div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3secondary_8c.html#4e7135773263906006d547371fc20c87">_p3_SECONDARY_C</a>&nbsp;&nbsp;&nbsp;0</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3secondary_8c.html#0ddf1224851353fc92bfbff6f499fa97">main</a> (int argc, char *argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3secondary_8c.html#02066c90815eee8c433d576699f2de35">sec_parse_cmdline</a> (int pc_argc, char *pc_argv[])</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3secondary_8c.html#95db124390fde328fcbafb3c60199e0c">sec_parse_config</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3secondary_8c.html#ef5d3782888a0fd1df41418d71b76a15">sec_init_config</a> ()</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3secondary_8c.html#9d93e17cf07a97b3d7ac0793fa5aa141">update_prihost</a> (<a class="el" href="struct__p3prihostcfg.html">p3prihostcfg</a> *prihost)</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct__p3sec__main.html">p3sec_main</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3secondary_8c.html#e4baf3a9549eb15921bb3cc1797200f2">secmain</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">enum <a class="el" href="p3share_8h.html#e88915a16e6d96be0907b862f1786832">ioctl_cmd</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3secondary_8c.html#4f6be7e5f5ccf5456ae2a964033cb8d1">iocmd</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">char&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3secondary_8c.html#c97995944c31825c46b7ea7e16b9474f">tbuf</a> [p3BUFSIZE]</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3secondary_8c.html#33417e7420182dd8d4c5879d75be2f69">p3buf</a> = <a class="el" href="p3ksecondary_8c.html#e992180cf3b16ba07cd8b1d87c2b1e1d">tbuf</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="4e7135773263906006d547371fc20c87"></a><!-- doxytag: member="p3secondary.c::_p3_SECONDARY_C" ref="4e7135773263906006d547371fc20c87" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _p3_SECONDARY_C&nbsp;&nbsp;&nbsp;0          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="0ddf1224851353fc92bfbff6f499fa97"></a><!-- doxytag: member="p3secondary.c::main" ref="0ddf1224851353fc92bfbff6f499fa97" args="(int argc, char *argv[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int main           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>argv</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b>Function:</b></dt><dd>main</dd></dl>
<dl class="user" compact><dt><b>Description:</b></dt><dd>Initialize the P3 Secondary application, then listen for requests from secondary P3 systems.</dd></dl>
<dl class="user" compact><dt><b>Inputs:</b></dt><dd><ul>
<li>argc: Number of arguments</li><li>argv: Argument vector</li></ul>
</dd></dl>
<dl class="user" compact><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status<ul>
<li>0 = OK</li><li>&lt;0 = Error </li></ul>
</li></ul>
</dd></dl>

<p>References <a class="el" href="p3secondary_8h-source.html#l00038">_p3sec_main::config</a>, <a class="el" href="p3secondary_8h-source.html#l00036">_p3sec_main::home</a>, <a class="el" href="p3utils_8c-source.html#l00093">init_kernel_comm()</a>, <a class="el" href="p3utils_8c-source.html#l00171">init_raw_socket()</a>, <a class="el" href="p3sec__net_8c-source.html#l00041">init_sec_net()</a>, <a class="el" href="p3sec__ui_8c-source.html#l00040">init_sec_ui()</a>, <a class="el" href="p3utils_8c-source.html#l00042">init_utils()</a>, <a class="el" href="p3base_8h-source.html#l00206">MSG_TIME</a>, <a class="el" href="mdefs_8h-source.html#l00019">NULL</a>, <a class="el" href="p3primary_8c-source.html#l00074">p3buf</a>, <a class="el" href="p3base_8h-source.html#l00185">p3calloc</a>, <a class="el" href="p3profile_8c-source.html#l00387">p3errmsg()</a>, <a class="el" href="p3base_8h-source.html#l00171">p3malloc</a>, <a class="el" href="p3base_8h-source.html#l00046">p3MSG_CRIT</a>, <a class="el" href="p3base_8h-source.html#l00051">p3MSG_DEBUG</a>, <a class="el" href="p3secondary_8h-source.html#l00039">p3SEC_CONFIG</a>, <a class="el" href="p3secondary_8h-source.html#l00037">p3SEC_HOME</a>, <a class="el" href="p3secondary_8c-source.html#l00194">sec_parse_cmdline()</a>, and <a class="el" href="p3secondary_8c-source.html#l00312">sec_parse_config()</a>.</p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="p3secondary_8c_0ddf1224851353fc92bfbff6f499fa97_cgraph.png" border="0" usemap="#p3secondary_8c_0ddf1224851353fc92bfbff6f499fa97_cgraph_map" alt=""></center>
<map name="p3secondary_8c_0ddf1224851353fc92bfbff6f499fa97_cgraph_map">
<area shape="rect" href="p3utils_8c.html#975a78ab2e7fa09061feb9326e1c184e" title="init_kernel_comm" alt="" coords="108,157,241,184"><area shape="rect" href="p3profile_8c.html#115044c21fee0be99499431a0d3cabdc" title="p3errmsg" alt="" coords="817,309,900,336"><area shape="rect" href="p3utils_8c.html#4568e0281d52429066ad7f514969ecfe" title="init_raw_socket" alt="" coords="649,259,767,285"><area shape="rect" href="p3sec__net_8c.html#940bd831c894fe807e2e0d6b129f677c" title="init_sec_net" alt="" coords="127,309,223,336"><area shape="rect" href="p3sec__ui_8c.html#e9c84cb692e9ae6ddf8cfc04d5e4870a" title="init_sec_ui" alt="" coords="131,360,219,387"><area shape="rect" href="p3utils_8c.html#48dcf53d0853bda50c969492a1bbf813" title="init_utils" alt="" coords="139,411,211,437"><area shape="rect" href="p3secondary_8c.html#02066c90815eee8c433d576699f2de35" title="sec_parse_cmdline" alt="" coords="291,436,435,463"><area shape="rect" href="p3secondary_8c.html#95db124390fde328fcbafb3c60199e0c" title="sec_parse_config" alt="" coords="297,512,428,539"><area shape="rect" href="p3pri__key__server_8c.html#0edcd21f595ebaf5ef29d150680aef15" title="init_key_serv" alt="" coords="311,107,415,133"><area shape="rect" href="p3pri__key__server_8c.html#57da622d9c7396cebb20afdad7ff5d92" title="buffer_handler" alt="" coords="485,56,597,83"><area shape="rect" href="p3crypto_8c.html#cdaa80371416def48998e5ff2e8d1471" title="p3_get_key" alt="" coords="661,5,755,32"><area shape="rect" href="p3sec__ui_8c.html#bc1bb60b629689bedd11f022ee01d883" title="sec_ui_handler" alt="" coords="305,360,420,387"><area shape="rect" href="p3share_8h.html#d4ee9a93e1902e17cd3a05f4e110575a" title="getsubnetcfg" alt="" coords="656,461,760,488"><area shape="rect" href="p3profile_8c.html#a44b4e5158dd78b2c1dfda311450d357" title="isallnum" alt="" coords="504,512,579,539"><area shape="rect" href="p3secondary_8c.html#ef5d3782888a0fd1df41418d71b76a15" title="sec_init_config" alt="" coords="484,563,599,589"><area shape="rect" href="p3utils_8c.html#32323aa18a7307b0c873ce87a6c82b7e" title="send_ioctl" alt="" coords="665,613,751,640"><area shape="rect" href="p3secondary_8c.html#9d93e17cf07a97b3d7ac0793fa5aa141" title="update_prihost" alt="" coords="483,664,600,691"></map>
</div>

</div>
</div><p>
<a class="anchor" name="02066c90815eee8c433d576699f2de35"></a><!-- doxytag: member="p3secondary.c::sec_parse_cmdline" ref="02066c90815eee8c433d576699f2de35" args="(int pc_argc, char *pc_argv[])" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sec_parse_cmdline           </td>
          <td>(</td>
          <td class="paramtype">int&nbsp;</td>
          <td class="paramname"> <em>pc_argc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">char *&nbsp;</td>
          <td class="paramname"> <em>pc_argv</em>[]</td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b>Function:</b></dt><dd>sec_parse_cmdline</dd></dl>
<dl class="user" compact><dt><b>Description:</b></dt><dd>Parse command line arguments supplied to the P3 Secondary application.</dd></dl>
<dl class="user" compact><dt><b>Inputs:</b></dt><dd><ul>
<li>pc_argc: Number of arguments</li><li>pc_argv: Argument vector</li></ul>
</dd></dl>
<dl class="user" compact><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status<ul>
<li>0 = OK</li><li>&lt;0 = Error</li><li>&gt;0 = Informational </li></ul>
</li></ul>
</dd></dl>

<p>References <a class="el" href="p3secondary_8h-source.html#l00038">_p3sec_main::config</a>, <a class="el" href="p3utils_8h-source.html#l00062">_p3util::flag</a>, <a class="el" href="p3secondary_8h-source.html#l00036">_p3sec_main::home</a>, <a class="el" href="mdefs_8h-source.html#l00019">NULL</a>, <a class="el" href="p3primary_8c-source.html#l00074">p3buf</a>, <a class="el" href="p3profile_8c-source.html#l00387">p3errmsg()</a>, <a class="el" href="p3base_8h-source.html#l00171">p3malloc</a>, <a class="el" href="p3base_8h-source.html#l00046">p3MSG_CRIT</a>, <a class="el" href="p3base_8h-source.html#l00047">p3MSG_ERR</a>, <a class="el" href="p3utils_8c-source.html#l00024">p3utils</a>, <a class="el" href="p3utils_8h-source.html#l00063">p3UTL_NINFO</a>, and <a class="el" href="p3base_8h-source.html#l00041">p3VERSION</a>.</p>

<p>Referenced by <a class="el" href="p3secondary_8c-source.html#l00068">main()</a>.</p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="p3secondary_8c_02066c90815eee8c433d576699f2de35_cgraph.png" border="0" usemap="#p3secondary_8c_02066c90815eee8c433d576699f2de35_cgraph_map" alt=""></center>
<map name="p3secondary_8c_02066c90815eee8c433d576699f2de35_cgraph_map">
<area shape="rect" href="p3profile_8c.html#115044c21fee0be99499431a0d3cabdc" title="p3errmsg" alt="" coords="199,5,281,32"></map>
</div>

</div>
</div><p>
<a class="anchor" name="95db124390fde328fcbafb3c60199e0c"></a><!-- doxytag: member="p3secondary.c::sec_parse_config" ref="95db124390fde328fcbafb3c60199e0c" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sec_parse_config           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b>Function:</b></dt><dd>sec_parse_config</dd></dl>
<dl class="user" compact><dt><b>Description:</b></dt><dd>Parse the P3 Secondary configuration file.</dd></dl>
<dl class="user" compact><dt><b>Inputs:</b></dt><dd><ul>
<li>None</li></ul>
</dd></dl>
<dl class="user" compact><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status<ul>
<li>0 = OK</li><li>&lt;0 = Error</li><li>&gt;0 = Config does not exist, use defaults </li></ul>
</li></ul>
</dd></dl>

<p>References <a class="el" href="struct__p3prihostcfg.html#dec9d1bd5e21ed9cc4de7ec036b26628">_p3prihostcfg::addr</a>, <a class="el" href="struct__p3secondarycfg.html#f5df3d567d304f7537228cc2cfd823c8">_p3secondarycfg::addr</a>, <a class="el" href="p3secondary_8h-source.html#l00040">_p3sec_main::cfg_data</a>, <a class="el" href="p3secondary_8h-source.html#l00042">_p3sec_main::cluster</a>, <a class="el" href="p3secondary_8h-source.html#l00038">_p3sec_main::config</a>, <a class="el" href="p3share_8h-source.html#l00106">_p3prihostcfg::flag</a>, <a class="el" href="p3utils_8h-source.html#l00095">_p3cluster::flag</a>, <a class="el" href="p3share_8h-source.html#l00087">_p3secondarycfg::flag</a>, <a class="el" href="p3utils_8c-source.html#l00455">getsubnetcfg()</a>, <a class="el" href="p3secondary_8h-source.html#l00036">_p3sec_main::home</a>, <a class="el" href="p3share_8h-source.html#l00156">_p3subnetcfg::id</a>, <a class="el" href="p3profile_8c-source.html#l00361">isallnum()</a>, <a class="el" href="p3profile_8c-source.html#l00031">line</a>, <a class="el" href="p3share_8h-source.html#l00018">LOCALEND</a>, <a class="el" href="p3share_8h-source.html#l00017">LOCALSTART</a>, <a class="el" href="struct__p3util.html#b8ffbad20fd56390e5997d7c33599685">_p3util::lochost</a>, <a class="el" href="p3share_8h-source.html#l00155">_p3subnetcfg::mask</a>, <a class="el" href="struct__p3subnetcfg.html#458e7792eabe62f86124729715baf592">_p3subnetcfg::net</a>, <a class="el" href="p3share_8h-source.html#l00150">_p3subnetcfg::next</a>, <a class="el" href="mdefs_8h-source.html#l00019">NULL</a>, <a class="el" href="p3primary_8c-source.html#l00074">p3buf</a>, <a class="el" href="p3base_8h-source.html#l00055">p3BUFSIZE</a>, <a class="el" href="p3base_8h-source.html#l00185">p3calloc</a>, <a class="el" href="p3profile_8c-source.html#l00387">p3errmsg()</a>, <a class="el" href="p3net_8h-source.html#l00047">p3HST_ID</a>, <a class="el" href="p3net_8h-source.html#l00048">p3HST_IPV4</a>, <a class="el" href="p3net_8h-source.html#l00049">p3HST_IPV6</a>, <a class="el" href="p3base_8h-source.html#l00046">p3MSG_CRIT</a>, <a class="el" href="p3base_8h-source.html#l00051">p3MSG_DEBUG</a>, <a class="el" href="p3base_8h-source.html#l00047">p3MSG_ERR</a>, <a class="el" href="p3share_8h-source.html#l00058">p3PRI_PORT</a>, <a class="el" href="p3utils_8c-source.html#l00024">p3utils</a>, <a class="el" href="p3base_8h-source.html#l00053">PATH_SEPARATOR</a>, <a class="el" href="p3share_8h-source.html#l00105">_p3prihostcfg::port</a>, <a class="el" href="struct__p3util.html#1056b2a503f0e0d940c56f0f2b109371">_p3util::remhost</a>, <a class="el" href="p3secondary_8c-source.html#l00761">sec_init_config()</a>, <a class="el" href="p3share_8h-source.html#l00035">secondarycfg</a>, <a class="el" href="p3utils_8c-source.html#l00281">send_ioctl()</a>, <a class="el" href="p3share_8h-source.html#l00103">_p3prihostcfg::subnets</a>, <a class="el" href="p3share_8h-source.html#l00104">_p3prihostcfg::subnetsz</a>, <a class="el" href="p3secondary_8c-source.html#l00851">update_prihost()</a>, <a class="el" href="p3share_8h-source.html#l00152">_p3subnetcfg::v4</a>, <a class="el" href="p3share_8h-source.html#l00100">_p3prihostcfg::v4</a>, <a class="el" href="p3utils_8h-source.html#l00055">_p3util::v4</a>, <a class="el" href="p3share_8h-source.html#l00084">_p3secondarycfg::v4</a>, <a class="el" href="p3share_8h-source.html#l00153">_p3subnetcfg::v6</a>, <a class="el" href="p3share_8h-source.html#l00101">_p3prihostcfg::v6</a>, <a class="el" href="p3utils_8h-source.html#l00056">_p3util::v6</a>, and <a class="el" href="p3share_8h-source.html#l00085">_p3secondarycfg::v6</a>.</p>

<p>Referenced by <a class="el" href="p3secondary_8c-source.html#l00068">main()</a>.</p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="p3secondary_8c_95db124390fde328fcbafb3c60199e0c_cgraph.png" border="0" usemap="#p3secondary_8c_95db124390fde328fcbafb3c60199e0c_cgraph_map" alt=""></center>
<map name="p3secondary_8c_95db124390fde328fcbafb3c60199e0c_cgraph_map">
<area shape="rect" href="p3share_8h.html#d4ee9a93e1902e17cd3a05f4e110575a" title="getsubnetcfg" alt="" coords="357,5,461,32"><area shape="rect" href="p3profile_8c.html#115044c21fee0be99499431a0d3cabdc" title="p3errmsg" alt="" coords="516,157,599,184"><area shape="rect" href="p3profile_8c.html#a44b4e5158dd78b2c1dfda311450d357" title="isallnum" alt="" coords="208,107,283,133"><area shape="rect" href="p3secondary_8c.html#ef5d3782888a0fd1df41418d71b76a15" title="sec_init_config" alt="" coords="352,157,467,184"><area shape="rect" href="p3utils_8c.html#32323aa18a7307b0c873ce87a6c82b7e" title="send_ioctl" alt="" coords="367,208,452,235"><area shape="rect" href="p3secondary_8c.html#9d93e17cf07a97b3d7ac0793fa5aa141" title="update_prihost" alt="" coords="187,259,304,285"></map>
</div>

</div>
</div><p>
<a class="anchor" name="ef5d3782888a0fd1df41418d71b76a15"></a><!-- doxytag: member="p3secondary.c::sec_init_config" ref="ef5d3782888a0fd1df41418d71b76a15" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int sec_init_config           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b>Function:</b></dt><dd>init_config</dd></dl>
<dl class="user" compact><dt><b>Description:</b></dt><dd>Initialize the configuration file for first time use.</dd></dl>
<dl class="user" compact><dt><b>Inputs:</b></dt><dd><ul>
<li>None</li></ul>
</dd></dl>
<dl class="user" compact><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status<ul>
<li>0 = OK</li><li>&lt;0 = Error </li></ul>
</li></ul>
</dd></dl>

<p>References <a class="el" href="p3secondary_8h-source.html#l00040">_p3sec_main::cfg_data</a>, <a class="el" href="p3secondary_8h-source.html#l00038">_p3sec_main::config</a>, <a class="el" href="p3secondary_8h-source.html#l00036">_p3sec_main::home</a>, <a class="el" href="mdefs_8h-source.html#l00019">NULL</a>, <a class="el" href="p3primary_8c-source.html#l00074">p3buf</a>, <a class="el" href="p3profile_8c-source.html#l00387">p3errmsg()</a>, <a class="el" href="p3base_8h-source.html#l00046">p3MSG_CRIT</a>, <a class="el" href="p3base_8h-source.html#l00060">p3SHARE_MODE</a>, and <a class="el" href="p3base_8h-source.html#l00053">PATH_SEPARATOR</a>.</p>

<p>Referenced by <a class="el" href="p3secondary_8c-source.html#l00312">sec_parse_config()</a>.</p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="p3secondary_8c_ef5d3782888a0fd1df41418d71b76a15_cgraph.png" border="0" usemap="#p3secondary_8c_ef5d3782888a0fd1df41418d71b76a15_cgraph_map" alt=""></center>
<map name="p3secondary_8c_ef5d3782888a0fd1df41418d71b76a15_cgraph_map">
<area shape="rect" href="p3profile_8c.html#115044c21fee0be99499431a0d3cabdc" title="p3errmsg" alt="" coords="169,5,252,32"></map>
</div>

</div>
</div><p>
<a class="anchor" name="9d93e17cf07a97b3d7ac0793fa5aa141"></a><!-- doxytag: member="p3secondary.c::update_prihost" ref="9d93e17cf07a97b3d7ac0793fa5aa141" args="(p3prihostcfg *prihost)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int update_prihost           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__p3prihostcfg.html">p3prihostcfg</a> *&nbsp;</td>
          <td class="paramname"> <em>prihost</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b>Function:</b></dt><dd>update_prihost</dd></dl>
<dl class="user" compact><dt><b>Description:</b></dt><dd>Build a remote primary host definition to be sent to the kernel module in an ioctl buffer. The list of subnet configurations is freed as the command buffer is built.</dd></dl>
<dl class="user" compact><dt><b>Inputs:</b></dt><dd><ul>
<li>prihost: The primary host definition, which contains a list of subnets associated with it.</li></ul>
</dd></dl>
<dl class="user" compact><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status<ul>
<li>0 = OK</li><li>&lt;0 = Error </li></ul>
</li></ul>
</dd></dl>

<p>References <a class="el" href="p3share_8h-source.html#l00150">_p3subnetcfg::next</a>, <a class="el" href="mdefs_8h-source.html#l00019">NULL</a>, <a class="el" href="p3primary_8c-source.html#l00074">p3buf</a>, <a class="el" href="p3profile_8c-source.html#l00387">p3errmsg()</a>, <a class="el" href="p3base_8h-source.html#l00171">p3malloc</a>, <a class="el" href="p3base_8h-source.html#l00046">p3MSG_CRIT</a>, <a class="el" href="p3base_8h-source.html#l00047">p3MSG_ERR</a>, <a class="el" href="p3base_8h-source.html#l00048">p3MSG_WARN</a>, <a class="el" href="p3share_8h-source.html#l00035">primaryhostcfg</a>, <a class="el" href="p3utils_8c-source.html#l00281">send_ioctl()</a>, <a class="el" href="p3share_8h-source.html#l00103">_p3prihostcfg::subnets</a>, and <a class="el" href="p3share_8h-source.html#l00104">_p3prihostcfg::subnetsz</a>.</p>

<p>Referenced by <a class="el" href="p3secondary_8c-source.html#l00312">sec_parse_config()</a>.</p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="p3secondary_8c_9d93e17cf07a97b3d7ac0793fa5aa141_cgraph.png" border="0" usemap="#p3secondary_8c_9d93e17cf07a97b3d7ac0793fa5aa141_cgraph_map" alt=""></center>
<map name="p3secondary_8c_9d93e17cf07a97b3d7ac0793fa5aa141_cgraph_map">
<area shape="rect" href="p3profile_8c.html#115044c21fee0be99499431a0d3cabdc" title="p3errmsg" alt="" coords="305,5,388,32"><area shape="rect" href="p3utils_8c.html#32323aa18a7307b0c873ce87a6c82b7e" title="send_ioctl" alt="" coords="171,31,256,57"></map>
</div>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="e4baf3a9549eb15921bb3cc1797200f2"></a><!-- doxytag: member="p3secondary.c::secmain" ref="e4baf3a9549eb15921bb3cc1797200f2" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct__p3sec__main.html">p3sec_main</a>* <a class="el" href="p3ksecondary_8h.html#e4baf3a9549eb15921bb3cc1797200f2">secmain</a> = NULL          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The main secondary structure 
</div>
</div><p>
<a class="anchor" name="4f6be7e5f5ccf5456ae2a964033cb8d1"></a><!-- doxytag: member="p3secondary.c::iocmd" ref="4f6be7e5f5ccf5456ae2a964033cb8d1" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="p3share_8h.html#e88915a16e6d96be0907b862f1786832">ioctl_cmd</a> <a class="el" href="p3kshare_8h.html#4f6be7e5f5ccf5456ae2a964033cb8d1">iocmd</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
ioctl_cmd defines the format of the ioctl data passed between the user and kernel space where the command meanings are:<ul>
<li>noop: Unused</li><li>primarycfg: Configuration data for a P3 primary system</li><li>secondarycfg: Configuration data for a P3 secondary system</li><li>prihostcfg: Configuration data for a remote P3 primary system</li><li>sechostcfg: Configuration data for a remote P3 secondary system</li><li>datakey1: The initial data key for a new P3 session</li><li>controlkey1: The initial control key for a new P3 session </li></ul>

</div>
</div><p>
<a class="anchor" name="c97995944c31825c46b7ea7e16b9474f"></a><!-- doxytag: member="p3secondary.c::tbuf" ref="c97995944c31825c46b7ea7e16b9474f" args="[p3BUFSIZE]" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char <a class="el" href="p3ksecondary_8c.html#e992180cf3b16ba07cd8b1d87c2b1e1d">tbuf</a>[p3BUFSIZE]          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Working buffer 
</div>
</div><p>
<a class="anchor" name="33417e7420182dd8d4c5879d75be2f69"></a><!-- doxytag: member="p3secondary.c::p3buf" ref="33417e7420182dd8d4c5879d75be2f69" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char * <a class="el" href="p3ksecondary_8c.html#33417e7420182dd8d4c5879d75be2f69">p3buf</a> = <a class="el" href="p3ksecondary_8c.html#e992180cf3b16ba07cd8b1d87c2b1e1d">tbuf</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Sep 24 10:44:31 2010 for Velocite Systems Protected Point to Point Solution by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
