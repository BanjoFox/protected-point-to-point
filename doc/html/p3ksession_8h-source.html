<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Velocite Systems Protected Point to Point Solution: p3ksession.h Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
<h1>p3ksession.h</h1><a href="p3ksession_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00008"></a>00008 <span class="preprocessor">#ifndef _p3kSESSION_H</span>
<a name="l00009"></a>00009 <span class="preprocessor"></span><span class="preprocessor">#define _p3kSESSION_H</span>
<a name="l00010"></a>00010 <span class="preprocessor"></span>
<a name="l00011"></a>00011 <span class="comment">/*****  INCLUDE FILES *****/</span>
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 <span class="preprocessor">#include "<a class="code" href="p3kbase_8h.html">p3kbase.h</a>"</span>
<a name="l00014"></a>00014 <span class="preprocessor">#include "<a class="code" href="p3kcrypto_8h.html">p3kcrypto.h</a>"</span>
<a name="l00015"></a>00015 
<a name="l00016"></a>00016 <span class="comment">/*****  CONSTANTS  *****/</span>
<a name="l00017"></a>00017 
<a name="l00018"></a><a class="code" href="p3ksession_8h.html#7865bcf6503e04d9382352ce7ed762d0">00018</a> <span class="preprocessor">#define p3STYPE_DATA            1</span>
<a name="l00019"></a><a class="code" href="p3ksession_8h.html#7637dca689aeb78a65ee26565104b8af">00019</a> <span class="preprocessor"></span><span class="preprocessor">#define p3STYPE_CTL             2</span>
<a name="l00020"></a>00020 <span class="preprocessor"></span>
<a name="l00021"></a><a class="code" href="p3ksession_8h.html#3634812481b4bd70d43af29305fb2d9e">00021</a> <span class="preprocessor">#define p3MAX_MSG_SZ            1460 - 96 - 16  </span><span class="comment">/* MSS - 2 IPv6 P3 headers - encrypt alignment */</span>
<a name="l00022"></a>00022 
<a name="l00023"></a><a class="code" href="p3ksession_8h.html#bb2288f4e0941b2c95c5b25e5cb6adca">00023</a> <span class="preprocessor">#define p3CMSG_KTYPE            0x0f    </span><span class="comment">/* Key type field */</span>
<a name="l00024"></a><a class="code" href="p3ksession_8h.html#061808a57374df904b2186e5f454ea0b">00024</a> <span class="preprocessor">#define p3CMSG_SET_KEY_ARRAY    1</span>
<a name="l00025"></a><a class="code" href="p3ksession_8h.html#51cf502b86b9c685a1375c180ab87d6b">00025</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CMSG_ACK_KEY_ARRAY    2</span>
<a name="l00026"></a><a class="code" href="p3ksession_8h.html#60effa9bb3acb2f6ef9175c8ff5fa422">00026</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CMSG_AKKERR           0x01    </span><span class="comment">/* ACK_KEY_ARRAY Key error */</span>
<a name="l00027"></a><a class="code" href="p3ksession_8h.html#2bbf1f59b4aa3cc6fbab2efb27c8e5b5">00027</a> <span class="preprocessor">#define p3CMSG_AKDERR           0x02    </span><span class="comment">/* ACK_KEY_ARRAY Data error */</span>
<a name="l00028"></a><a class="code" href="p3ksession_8h.html#94d6c480ed9c43a278a83e53d4101fa2">00028</a> <span class="preprocessor">#define p3CMSG_AKERR \</span>
<a name="l00029"></a>00029 <span class="preprocessor">    (p3CMSG_AKKERR | p3CMSG_AKDERR)</span>
<a name="l00030"></a><a class="code" href="p3ksession_8h.html#e115d3fa059167950439b75e643f6078">00030</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CMSG_REPLACE_KEY      3</span>
<a name="l00031"></a><a class="code" href="p3ksession_8h.html#cd2e35cea676bb2909d9509768a44146">00031</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CMSG_KRCIDX           0x10    </span><span class="comment">/* REPLACE_KEY Control index */</span>
<a name="l00032"></a><a class="code" href="p3ksession_8h.html#d61c7c51aded08bbac13307cc51b465d">00032</a> <span class="preprocessor">#define p3CMSG_KRDIDX           0x20    </span><span class="comment">/* REPLACE_KEY Data index */</span>
<a name="l00033"></a><a class="code" href="p3ksession_8h.html#ef9a285d8e3f1f7c90b8c74505353584">00033</a> <span class="preprocessor">#define p3CMSG_KRXMIT           0x40    </span><span class="comment">/* REPLACE_KEY Retransmit */</span>
<a name="l00034"></a><a class="code" href="p3ksession_8h.html#2e133285694777e39e31760f8a2b6fcd">00034</a> <span class="preprocessor">#define p3CMSG_REKEY            4</span>
<a name="l00035"></a><a class="code" href="p3ksession_8h.html#4299bc16975e94f62d29a7ca5eede120">00035</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CMSG_RKCKERR          0x01    </span><span class="comment">/* REKEY Control key error */</span>
<a name="l00036"></a><a class="code" href="p3ksession_8h.html#aef51b321e51d4348536adf749cf7435">00036</a> <span class="preprocessor">#define p3CMSG_RKCIERR          0x02    </span><span class="comment">/* REKEY Control key index error */</span>
<a name="l00037"></a><a class="code" href="p3ksession_8h.html#cd6f814855971dbe1c77d37c108943af">00037</a> <span class="preprocessor">#define p3CMSG_RKDKERR          0x04    </span><span class="comment">/* REKEY Data key error */</span>
<a name="l00038"></a><a class="code" href="p3ksession_8h.html#492f580aab5642ecb85e8f869a76ea2c">00038</a> <span class="preprocessor">#define p3CMSG_RKDIERR          0x08    </span><span class="comment">/* REKEY Data key index error */</span>
<a name="l00039"></a><a class="code" href="p3ksession_8h.html#99c66991c3cf74c322a5769e07679b56">00039</a> <span class="preprocessor">#define p3CMSG_RKERR \</span>
<a name="l00040"></a>00040 <span class="preprocessor">    (p3CMSG_RKCKERR | p3CMSG_RKCIERR | p3CMSG_RKDKERR | p3CMSG_RKDIERR)</span>
<a name="l00041"></a><a class="code" href="p3ksession_8h.html#c748fd7feb032391afebc731f790f56a">00041</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CMSG_REKEY_TEST       5</span>
<a name="l00042"></a><a class="code" href="p3ksession_8h.html#398e02376281a1b3cd8208fe1b17ad4f">00042</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CMSG_HRTBEAT_QUERY    6</span>
<a name="l00043"></a><a class="code" href="p3ksession_8h.html#dfa37ed42ccf906c7a788f3f2bb03826">00043</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CMSG_HRTBEAT_ANSWER   7</span>
<a name="l00044"></a><a class="code" href="p3ksession_8h.html#543f5ec4a1b0b7f0549bc413f73b5586">00044</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CMSG_STATUS_REQ       8</span>
<a name="l00045"></a><a class="code" href="p3ksession_8h.html#8e31244e34ae5708962bf3712b830266">00045</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CMSG_STATUS_RESP      9</span>
<a name="l00046"></a><a class="code" href="p3ksession_8h.html#8de27e6fe7405f092bbd2c3a90c37cfb">00046</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CMSG_UPDATE_INFO      10</span>
<a name="l00047"></a><a class="code" href="p3ksession_8h.html#03d965ba32775ac2f7c97fbab42ded2a">00047</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CMSG_UICODE           0x01    </span><span class="comment">/* UPDATE_INFO Code update */</span>
<a name="l00048"></a><a class="code" href="p3ksession_8h.html#6b3609778ab6fbc6ab688c6af4f79356">00048</a> <span class="preprocessor">#define p3CMSG_UICFG            0x02    </span><span class="comment">/* UPDATE_INFO Configuration update */</span>
<a name="l00049"></a><a class="code" href="p3ksession_8h.html#3f75c6ea278157b0eb0993d747f53df6">00049</a> <span class="preprocessor">#define p3CMSG_ACK_UPDATE       11</span>
<a name="l00050"></a><a class="code" href="p3ksession_8h.html#62797f64bcb93703748196db607fadde">00050</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CMSG_AUDERR           0x01    </span><span class="comment">/* ACK_UPDATE Update data error */</span>
<a name="l00051"></a><a class="code" href="p3ksession_8h.html#082def1cf239e3d9b45d1860d55cd099">00051</a> <span class="preprocessor">#define p3CMSG_AUUERR           0x02    </span><span class="comment">/* ACK_UPDATE Update error */</span>
<a name="l00052"></a><a class="code" href="p3ksession_8h.html#5881c3270ca66214f0b6075dd954d489">00052</a> <span class="preprocessor">#define p3CMSG_AUERR \</span>
<a name="l00053"></a>00053 <span class="preprocessor">    (p3CMSG_AUDERR | p3CMSG_AUUERR)</span>
<a name="l00054"></a><a class="code" href="p3ksession_8h.html#9e94ca9b2829d819d4496f75bc3fcdbd">00054</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CMSG_SHUTDOWN         12</span>
<a name="l00055"></a><a class="code" href="p3ksession_8h.html#e842f02f8e3475ad06ae167f37e74b8f">00055</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CMSG_SHRIMM           0x01    </span><span class="comment">/* SHUTDOWN Restart immediately */</span>
<a name="l00056"></a><a class="code" href="p3ksession_8h.html#1ff1b2efb3799c797e0dc2f873f60dc6">00056</a> <span class="preprocessor">#define p3CMSG_SHRTIME          0x02    </span><span class="comment">/* SHUTDOWN Restart after timeout */</span>
<a name="l00057"></a><a class="code" href="p3ksession_8h.html#177f13de6abc0656f1ee447cb2cda956">00057</a> <span class="preprocessor">#define p3CMSG_ACK_SHUTDOWN     13</span>
<a name="l00058"></a><a class="code" href="p3ksession_8h.html#37d2936f2f3ec2617bd3dffd0d9e375a">00058</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CMSG_ASACK            0x01    </span><span class="comment">/* ACK_SHUTDOWN Shutdown ACK */</span>
<a name="l00059"></a>00059 
<a name="l00060"></a>00060 <span class="comment">/*****  DATA DEFINITIONS  *****/</span>
<a name="l00061"></a>00061 
<a name="l00062"></a><a class="code" href="p3ksession_8h.html#2451d0f50f1cf3819034ff86bc181468">00062</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct__p3host.html">_p3host</a> <a class="code" href="struct__p3host.html">p3host</a>;
<a name="l00063"></a><a class="code" href="p3ksession_8h.html#9b6cd103bb13010761e047886b00a731">00063</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct__p3session.html">_p3session</a> <a class="code" href="struct__p3session.html">p3session</a>;
<a name="l00064"></a><a class="code" href="p3ksession_8h.html#9e91c012ed0c808ee4066a8009b65b3d">00064</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="struct__p3ctlmsg.html">_p3ctlmsg</a> <a class="code" href="struct__p3ctlmsg.html">p3ctlmsg</a>;
<a name="l00065"></a>00065 
<a name="l00074"></a>00074 <span class="keyword">struct </span><a class="code" href="struct__p3host.html">_p3host</a> {
<a name="l00075"></a>00075     <a class="code" href="struct__p3host.html">p3host</a>          *<a class="code" href="struct__p3host.html#75b056167273d07a3d74ab55dbe0f7b8">next</a>;      <span class="comment">/*&lt;&lt; Timer queue pointer */</span>
<a name="l00076"></a><a class="code" href="struct__p3host.html#bbabc11050aeb366c87740dbdb9bf9b6">00076</a>     <a class="code" href="struct__p3host.html">p3host</a>          *<a class="code" href="struct__p3host.html#bbabc11050aeb366c87740dbdb9bf9b6">hlist</a>;     <span class="comment">/*&lt;&lt; TODO: Change list to Red Black tree */</span>
<a name="l00077"></a><a class="code" href="struct__p3host.html#3cabcd8539e3d936bcf1e64fceb1aa1d">00077</a>     <a class="code" href="struct__p3session.html">p3session</a>       *<a class="code" href="struct__p3host.html#3cabcd8539e3d936bcf1e64fceb1aa1d">session</a>;   <span class="comment">/*&lt;&lt; Session information */</span>
<a name="l00078"></a>00078     <span class="keyword">union </span>{
<a name="l00079"></a>00079         <span class="keyword">struct </span>in_addr  v4;
<a name="l00080"></a>00080         <span class="keyword">struct </span>in6_addr v6;
<a name="l00081"></a>00081     } <a class="code" href="struct__p3host.html#1d30157fd8630192bcadb18c25dacd9f">addr</a>;                     <span class="comment">/*&lt;&lt; Host address (IPv4 or IPv6) */</span>
<a name="l00082"></a><a class="code" href="struct__p3host.html#aceb77a3f99fa071318f5cb002862683">00082</a>     <span class="keywordtype">int</span>             <a class="code" href="struct__p3host.html#aceb77a3f99fa071318f5cb002862683">hb_wait</a>;    <span class="comment">/*&lt;&lt; Period between heartbeats in seconds */</span>
<a name="l00083"></a><a class="code" href="struct__p3host.html#1d49876600c3e463093ca3a40d5c8dae">00083</a>     <span class="keywordtype">int</span>             <a class="code" href="struct__p3host.html#1d49876600c3e463093ca3a40d5c8dae">hb_fail</a>;    <span class="comment">/*&lt;&lt; Length of heartbeat failure in seconds */</span>
<a name="l00084"></a><a class="code" href="struct__p3host.html#f6c6d7947e02a9704e9f9fb8f4e8443f">00084</a>     <span class="keywordtype">int</span>             <a class="code" href="struct__p3host.html#f6c6d7947e02a9704e9f9fb8f4e8443f">port</a>;       <span class="comment">/*&lt;&lt; Primary listener port */</span>
<a name="l00085"></a><a class="code" href="p3ksession_8h.html#e25cdb0fc8d9405af2e1d838190e8058">00085</a> <span class="preprocessor">#define p3PRI_PORT      5653    </span><span class="comment">/* Default */</span>
<a name="l00086"></a>00086     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    <a class="code" href="struct__p3host.html#8b67cf2fcb32fbb74be05b4defa7b037">flag</a>;
<a name="l00087"></a><a class="code" href="p3ksession_8h.html#3c14f8ddeab89a8726747ca84eece3db">00087</a> <span class="preprocessor">#define p3HST_ID    0x000fffff  </span><span class="comment">/* Host ID */</span>
<a name="l00088"></a><a class="code" href="p3ksession_8h.html#914075881b1f86db2f10b186c6ad39d7">00088</a> <span class="preprocessor">#define p3HST_IPVER 0x00300000  </span><span class="comment">/* IP version field */</span>
<a name="l00089"></a><a class="code" href="p3ksession_8h.html#ba0ca1bccab88a2db5eee3eccb37b151">00089</a> <span class="preprocessor">#define p3HST_IPV4  0x00100000  </span><span class="comment">/* Host address is IPv4 */</span>
<a name="l00090"></a><a class="code" href="p3ksession_8h.html#5503acd61ffac5e7e01093df4da48a98">00090</a> <span class="preprocessor">#define p3HST_IPV6  0x00200000  </span><span class="comment">/* Host address is IPv6 */</span>
<a name="l00091"></a><a class="code" href="p3ksession_8h.html#8cf910627d799296aab0adb1654e4a49">00091</a> <span class="preprocessor">#define p3HST_ARRAY 0x00400000  </span><span class="comment">/* Key arrays allowed */</span>
<a name="l00092"></a><a class="code" href="p3ksession_8h.html#fa29262b01aaf5ca4df0111353209440">00092</a> <span class="preprocessor">#define p3HST_KTYPE 0x0f000000  </span><span class="comment">/* Key type field */</span>
<a name="l00093"></a><a class="code" href="p3ksession_8h.html#9e677ac9a1dafc9c69ec7b154818145c">00093</a> <span class="preprocessor">#define p3HST_KTSHF 24          </span><span class="comment">/* Field shift amount */</span>
<a name="l00094"></a>00094 };
<a name="l00095"></a>00095 
<a name="l00104"></a><a class="code" href="struct__p3session.html">00104</a> <span class="keyword">struct </span><a class="code" href="struct__p3session.html">_p3session</a> {
<a name="l00105"></a><a class="code" href="struct__p3session.html#5e02ca8bbc4341f6fd5ebb70a0d187b7">00105</a>     <a class="code" href="struct__p3host.html">p3host</a>          *<a class="code" href="struct__p3session.html#5e02ca8bbc4341f6fd5ebb70a0d187b7">host</a>;      <span class="comment">/*&lt;&lt; The owning host */</span>
<a name="l00106"></a><a class="code" href="struct__p3session.html#708ff9ece76297f6d25b8036431c1352">00106</a>     <a class="code" href="struct__p3keymgmt.html">p3keymgmt</a>       <a class="code" href="struct__p3session.html#708ff9ece76297f6d25b8036431c1352">keymgmt</a>;    <span class="comment">/*&lt;&lt; Keys to be managed for a session */</span>
<a name="l00107"></a><a class="code" href="struct__p3session.html#f022cc9f83d4553e156e870eefd0f63f">00107</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>   *<a class="code" href="struct__p3session.html#f022cc9f83d4553e156e870eefd0f63f">keylist</a>;   <span class="comment">/*&lt;&lt; Key array */</span>
<a name="l00108"></a><a class="code" href="struct__p3session.html#d97b7f53fd94af9760fc6cd65f38a037">00108</a>     <span class="keywordtype">int</span>             <a class="code" href="struct__p3session.html#d97b7f53fd94af9760fc6cd65f38a037">listsize</a>;   <span class="comment">/*&lt;&lt; Size of key array */</span>
<a name="l00109"></a><a class="code" href="struct__p3session.html#b6b39a55fcd7ad90ea8c758a4dbdb0cb">00109</a>     <span class="keywordtype">int</span>             <a class="code" href="struct__p3session.html#b6b39a55fcd7ad90ea8c758a4dbdb0cb">dindex</a>;     <span class="comment">/*&lt;&lt; Data key index */</span>
<a name="l00110"></a><a class="code" href="struct__p3session.html#4371c517d7b5fe2b72e18647a91de495">00110</a>     <span class="keywordtype">int</span>             <a class="code" href="struct__p3session.html#4371c517d7b5fe2b72e18647a91de495">cindex</a>;     <span class="comment">/*&lt;&lt; Control key index */</span>
<a name="l00111"></a>00111     <span class="comment">// NOTE: The P3 session sequence starts at 1.  0 is used internally.</span>
<a name="l00112"></a><a class="code" href="struct__p3session.html#803548cd92261c03da05cffa39a95cb5">00112</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    <a class="code" href="struct__p3session.html#803548cd92261c03da05cffa39a95cb5">sseq</a>;       <span class="comment">/*&lt;&lt; Sequence for data sent using key 1 */</span>
<a name="l00113"></a><a class="code" href="p3ksession_8h.html#f4e1093b9606a7e69af043deac39d328">00113</a> <span class="preprocessor">#define p3SEQ_DIFF  0xa65d</span>
<a name="l00114"></a><a class="code" href="struct__p3session.html#52bbf949d57ea2bb9824330f2c96d273">00114</a> <span class="preprocessor"></span>    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    <a class="code" href="struct__p3session.html#52bbf949d57ea2bb9824330f2c96d273">rID0</a>;       <span class="comment">/*&lt;&lt; Sequence start for data received using key 0 */</span>
<a name="l00115"></a><a class="code" href="struct__p3session.html#4c7c2e35ed39529b7596d3daed917faa">00115</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    <a class="code" href="struct__p3session.html#4c7c2e35ed39529b7596d3daed917faa">rID1</a>;       <span class="comment">/*&lt;&lt; Sequence start for data received using key 1 */</span>
<a name="l00116"></a>00116 <span class="preprocessor">#ifndef _p3_SECONDARY</span>
<a name="l00117"></a>00117 <span class="preprocessor"></span>    time_t          dikey;      <span class="comment">/*&lt;&lt; Next time to use data index */</span>
<a name="l00118"></a>00118     time_t          cikey;      <span class="comment">/*&lt;&lt; Next time to use control index */</span>
<a name="l00119"></a>00119     <span class="keywordtype">int</span>             ditime;     <span class="comment">/*&lt;&lt; Period to rekey data from list */</span>
<a name="l00120"></a>00120     <span class="keywordtype">int</span>             citime;     <span class="comment">/*&lt;&lt; Period to rekey control from list */</span>
<a name="l00121"></a>00121     time_t          rekey;      <span class="comment">/*&lt;&lt; Next time to rekey */</span>
<a name="l00122"></a>00122     <span class="keywordtype">int</span>             rk_wait;    <span class="comment">/*&lt;&lt; Period to initiate rekeying in seconds */</span>
<a name="l00123"></a>00123 <span class="preprocessor">#endif</span>
<a name="l00124"></a><a class="code" href="struct__p3session.html#72c4fb0a17d3869000ea6d548b7bff42">00124</a> <span class="preprocessor"></span>    <a class="code" href="p3linux_8h.html#d55c459e97f7d99a3ef4c4f2a7dc31e2">p3lock</a>          <a class="code" href="struct__p3session.html#72c4fb0a17d3869000ea6d548b7bff42">lock</a>;       <span class="comment">/*&lt;&lt; Session lock */</span>
<a name="l00125"></a>00125 <span class="comment">/* There are 2 P3 headers.  They are both the same size because the ESP header</span>
<a name="l00126"></a>00126 <span class="comment"> * and the UDP header are the same size.  The constant fields in the IP header</span>
<a name="l00127"></a>00127 <span class="comment"> * of the P3 header are built when the session is created and the rest are set</span>
<a name="l00128"></a>00128 <span class="comment"> * to zero.  The ESP/UDP headers are cleared and appropriately filled in for</span>
<a name="l00129"></a>00129 <span class="comment"> * each packet.</span>
<a name="l00130"></a>00130 <span class="comment"> * - P3 session header:  This is prepended to every P3 packet</span>
<a name="l00131"></a>00131 <span class="comment"> * - P3 control header:  This is prepended to P3 control messages.  Note that</span>
<a name="l00132"></a>00132 <span class="comment"> *   the total packet len must be a multiple of 16.</span>
<a name="l00133"></a>00133 <span class="comment"> */</span>
<a name="l00134"></a><a class="code" href="struct__p3session.html#00e96cda2a4fc0bf65a1b79377b84fce">00134</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>   *<a class="code" href="struct__p3session.html#00e96cda2a4fc0bf65a1b79377b84fce">p3hdr</a>;     <span class="comment">/*&lt;&lt; P3 network header */</span>
<a name="l00135"></a><a class="code" href="p3ksession_8h.html#82a29952aadff952e66b5e30720bc993">00135</a> <span class="preprocessor">#define p3HDR_SIZE      8       </span><span class="comment">/* The size of the P3 encryption (ESP) header */</span>
<a name="l00136"></a><a class="code" href="p3ksession_8h.html#084dba7a9188ac18a605c1cbcdacceac">00136</a> <span class="preprocessor">#define p3SESSION_HDR4  (20 + p3HDR_SIZE)</span>
<a name="l00137"></a><a class="code" href="p3ksession_8h.html#68e2803e89fe27fa75b01b8963aa3603">00137</a> <span class="preprocessor"></span><span class="preprocessor">#define p3SESSION_HDR6  (40 + p3HDR_SIZE)</span>
<a name="l00138"></a><a class="code" href="p3ksession_8h.html#2b1cda3dbead589adbba8a14f49affbd">00138</a> <span class="preprocessor"></span><span class="preprocessor">#define p3CONTROL_HDR4  28      </span><span class="comment">/* IPv4 + UDP header */</span>
<a name="l00139"></a><a class="code" href="p3ksession_8h.html#f5c3acb28cef94a260d19d128f17243f">00139</a> <span class="preprocessor">#define p3CONTROL_HDR6  48      </span><span class="comment">/* IPv6 + UDP header */</span>
<a name="l00140"></a><a class="code" href="struct__p3session.html#5f835a92e6cdbcb56112ff50e0dc1bf5">00140</a>     <span class="keywordtype">int</span>             <a class="code" href="struct__p3session.html#5f835a92e6cdbcb56112ff50e0dc1bf5">hdrlen</a>;     <span class="comment">/*&lt;&lt; Length of P3 network header */</span>
<a name="l00141"></a><a class="code" href="struct__p3session.html#be9d59bf1b985103be2f2093e3c84709">00141</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>    <a class="code" href="struct__p3session.html#be9d59bf1b985103be2f2093e3c84709">flag</a>;
<a name="l00142"></a><a class="code" href="p3ksession_8h.html#5c29a45843967833c199b2b48773f76e">00142</a> <span class="preprocessor">#define p3PSS_KTYPE 0x0000000f  </span><span class="comment">/* Key type (see p3crypto.h) */</span>
<a name="l00143"></a><a class="code" href="p3ksession_8h.html#33e51f395cf250c819a85f7414f7fadd">00143</a> <span class="preprocessor">#define p3PSS_ACT   0x00000010  </span><span class="comment">/* Session is active */</span>
<a name="l00144"></a><a class="code" href="p3ksession_8h.html#5172998741eb3c478ba07e314836b58f">00144</a> <span class="preprocessor">#define p3PSS_REKEY 0x00000020  </span><span class="comment">/* Session being rekeyed */</span>
<a name="l00145"></a><a class="code" href="p3ksession_8h.html#189fb68247b8335bf616ae1aa2ff6a66">00145</a> <span class="preprocessor">#define p3PSS_DRDY  0x00000040  </span><span class="comment">/* New data key has been retrieved */</span>
<a name="l00146"></a><a class="code" href="p3ksession_8h.html#bd1975fff5ee5bac77be87a62c88b515">00146</a> <span class="preprocessor">#define p3PSS_CRDY  0x00000080  </span><span class="comment">/* New control key has been retrieved */</span>
<a name="l00147"></a>00147 <span class="comment">// reserved p3HST_IPV4  0x00100000  /* Host address is IPv4 */</span>
<a name="l00148"></a>00148 <span class="comment">// reserved p3HST_IPV6  0x00200000  /* Host address is IPv6 */</span>
<a name="l00149"></a>00149 };
<a name="l00150"></a>00150 
<a name="l00151"></a><a class="code" href="p3ksession_8h.html#5522a5bfa6815eafcbabcfff00750ff9">00151</a> <span class="preprocessor">#define p3SESSION_SIZE  (sizeof(p3session) + (p3KMG_KEYS * sizeof(p3key)))</span>
<a name="l00152"></a>00152 <span class="preprocessor"></span>
<a name="l00161"></a><a class="code" href="struct__p3ctlmsg.html">00161</a> <span class="keyword">struct </span><a class="code" href="struct__p3ctlmsg.html">_p3ctlmsg</a> {
<a name="l00162"></a><a class="code" href="struct__p3ctlmsg.html#a0001385bfcc400ab50e421563c58015">00162</a>     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>   *<a class="code" href="struct__p3ctlmsg.html#a0001385bfcc400ab50e421563c58015">message</a>;   <span class="comment">/*&lt;&lt; Message data including length */</span>
<a name="l00163"></a><a class="code" href="struct__p3ctlmsg.html#a64567671a7a33c8a403074aa8d59344">00163</a>     <span class="keywordtype">int</span>             <a class="code" href="struct__p3ctlmsg.html#a64567671a7a33c8a403074aa8d59344">len</a>;        <span class="comment">/*&lt;&lt; Length of message buffer */</span>
<a name="l00164"></a>00164 };
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 <span class="comment">/*****  MACROS  *****/</span>
<a name="l00167"></a>00167 
<a name="l00168"></a>00168 <span class="comment">/*****  PROTOYPES  *****/</span>
<a name="l00169"></a>00169 
<a name="l00170"></a>00170 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="p3ksession_8c.html#67c0368da866a1d40d64c5c5f62c0da5">init_session</a>(<a class="code" href="struct__p3host.html">p3host</a> *<a class="code" href="planning_8txt.html#67db5ca565845ab69d176efade637c1e">host</a>, <span class="keywordtype">void</span> *srcaddr);
<a name="l00171"></a>00171 <span class="keyword">extern</span> <a class="code" href="struct__p3ctlmsg.html">p3ctlmsg</a> *<a class="code" href="p3ksession_8h.html#82ba0db0ef7ddf7e28cc28fab0761aa3">build_newkey_message</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flag, <a class="code" href="struct__p3session.html">p3session</a> *p3sess, <a class="code" href="struct__p3key__mgr.html">p3key_mgr</a> *key_mgr);
<a name="l00172"></a>00172 <span class="keyword">extern</span> <a class="code" href="struct__p3ctlmsg.html">p3ctlmsg</a> *<a class="code" href="p3ksession_8c.html#0afcca28441ee6077ad65ec7cbd04501">build_flag_message</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flag);
<a name="l00173"></a>00173 <span class="keyword">extern</span> <a class="code" href="struct__p3ctlmsg.html">p3ctlmsg</a> *<a class="code" href="p3ksession_8c.html#4a5a8ada1f7c67ee101fd8f2865b8436">build_vlen_message</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> flag, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *message, <span class="keywordtype">int</span> len);
<a name="l00174"></a>00174 <span class="keyword">extern</span> <a class="code" href="struct__p3ctlmsg.html">p3ctlmsg</a> *<a class="code" href="p3ksession_8c.html#61826257e17f2923e2300451ceb58d58">build_heartbeat_message</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> sequence);
<a name="l00175"></a>00175 <span class="keyword">extern</span> <a class="code" href="struct__p3ctlmsg.html">p3ctlmsg</a> *<a class="code" href="p3ksession_8c.html#594393343fee6c7a0fc9c6d7fc6ba265">build_ctl_message</a>(<span class="keywordtype">int</span> type, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *message, <span class="keywordtype">int</span> len);
<a name="l00176"></a>00176 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="p3ksession_8c.html#ccd384ee6eff17fb46a44bcd0a2e8ed9">parse_ctl_message</a>(<a class="code" href="struct__p3ctlmsg.html">p3ctlmsg</a> *ctlmsg, <a class="code" href="struct__p3session.html">p3session</a> *p3sess);
<a name="l00177"></a>00177 
<a name="l00178"></a>00178 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="p3kpri__session_8c.html#bed8a5190bb70efbc926027276ed28c9">pri_session_manager</a>(<span class="keywordtype">void</span>);
<a name="l00179"></a>00179 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="p3kpri__session_8c.html#ca3d48d1ee35eb9d228250606f4394c3">key_array_error</a>(<span class="keywordtype">int</span> flag, <a class="code" href="struct__p3session.html">p3session</a> *p3sess);
<a name="l00180"></a>00180 <span class="keywordtype">void</span> <a class="code" href="p3kpri__session_8c.html#52a21487fa0fd6103b29853aa2152f58">rekey_session</a>(<span class="keywordtype">int</span> flag, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key_num, <a class="code" href="struct__p3session.html">p3session</a> *p3sess);
<a name="l00181"></a>00181 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="p3kpri__session_8c.html#1e7a96342264a49601111f552b6b0219">rekey_test_pri</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *message, <span class="keywordtype">int</span> size, <a class="code" href="struct__p3session.html">p3session</a> *p3sess);
<a name="l00182"></a>00182 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="p3kpri__session_8c.html#9bb8f1ec82fa429ae11637caa19bf1f5">heartbeat_answer</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> time, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> seqnum, <a class="code" href="struct__p3session.html">p3session</a> *p3sess);
<a name="l00183"></a>00183 
<a name="l00184"></a>00184 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="p3ksec__session_8c.html#552e186651a9de0f8cdc8104e71e8597">sec_session_manager</a>(<span class="keywordtype">void</span>);
<a name="l00185"></a>00185 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="p3ksec__session_8c.html#6630ebbd7b47ed8338e449d26f9958ec">set_key_array</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *message, <span class="keywordtype">int</span> ksize, <span class="keywordtype">int</span> dsize, <a class="code" href="struct__p3session.html">p3session</a> *p3sess);
<a name="l00186"></a>00186 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="p3ksec__session_8c.html#2cee32c0152fbe0cb76c0739d0c72246">replace_key</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *dkey, <span class="keywordtype">int</span> dindex, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *ckey, <span class="keywordtype">int</span> cindex, <a class="code" href="struct__p3session.html">p3session</a> *p3sess);
<a name="l00187"></a>00187 <span class="keyword">extern</span> <span class="keywordtype">void</span> <a class="code" href="p3kpri__session_8c.html#52a21487fa0fd6103b29853aa2152f58">rekey_session</a>(<span class="keywordtype">int</span> flag, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> key_num, <a class="code" href="struct__p3session.html">p3session</a> *p3sess);
<a name="l00188"></a>00188 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="p3ksec__session_8c.html#52262f83863e788f79c32917699172be">rekey_test_sec</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *message, <span class="keywordtype">int</span> size, <a class="code" href="struct__p3session.html">p3session</a> *p3sess);
<a name="l00189"></a>00189 <span class="keyword">extern</span> <span class="keywordtype">int</span> <a class="code" href="p3ksec__session_8c.html#11bf297973fd2df2fb5da58abc220f3e">heartbeat_query</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> time, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> seqnum, <a class="code" href="struct__p3session.html">p3session</a> *p3sess);
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="comment">/*****  EXTERNAL DEFINITIONS  *****/</span>
<a name="l00192"></a>00192 
<a name="l00193"></a>00193 <span class="preprocessor">#ifdef _p3_SECONDARY</span>
<a name="l00194"></a>00194 <span class="preprocessor"></span><span class="keyword">extern</span> <a class="code" href="struct__p3session.html">p3session</a> *<a class="code" href="p3ksession_8h.html#f01e1812f2bb3a71e6bdf3a19a4120f8">p3sess</a>;
<a name="l00195"></a>00195 <span class="preprocessor">#endif</span>
<a name="l00196"></a>00196 <span class="preprocessor"></span>
<a name="l00197"></a>00197 <span class="preprocessor">#endif </span><span class="comment">/* _p3kSESSION_H */</span>
<a name="l00198"></a>00198 
</pre></div></div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Sep 24 10:44:24 2010 for Velocite Systems Protected Point to Point Solution by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
