<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>Velocite Systems Protected Point to Point Solution: p3pri_key_server.c File Reference</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.6 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
</div>
<div class="contents">
<h1>p3pri_key_server.c File Reference</h1><hr><a name="_details"></a><h2>Detailed Description</h2>
<h3>Protected Point to Point primary key server file</h3>
<p>
Copyright (C) Velocite 2010<p>
The key server manages true random keys for encryption. It constantly produces keys which are placed on the circular buffer shared with the kernel module. Whenever the circular buffer has slots for keys the key server fills all slots with new keys. 
<p>
<code>#include &quot;<a class="el" href="p3pri__key__server_8h-source.html">p3pri_key_server.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="p3primary_8h-source.html">p3primary.h</a>&quot;</code><br>
<code>#include &quot;<a class="el" href="p3utils_8h-source.html">p3utils.h</a>&quot;</code><br>

<p>
<div class="dynheader">
Include dependency graph for p3pri_key_server.c:</div>
<div class="dynsection">
<p><center><img src="p3pri__key__server_8c__incl.png" border="0" usemap="#p3pri_key_server.c_map" alt=""></center>
<map name="p3pri_key_server.c_map">
<area shape="rect" href="p3pri__key__server_8h.html" title="p3pri_key_server.h" alt="" coords="264,84,403,111"><area shape="rect" href="p3primary_8h.html" title="p3primary.h" alt="" coords="499,84,595,111"><area shape="rect" href="p3utils_8h.html" title="p3utils.h" alt="" coords="467,161,541,188"><area shape="rect" href="p3crypto_8h.html" title="p3crypto.h" alt="" coords="224,239,312,265"><area shape="rect" href="p3base_8h.html" title="p3base.h" alt="" coords="701,239,781,265"><area shape="rect" href="p3net_8h.html" title="p3net.h" alt="" coords="579,161,648,188"><area shape="rect" href="p3share_8h.html" title="p3share.h" alt="" coords="348,161,433,188"></map>
</div>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3pri__key__server_8c.html#0419ecb87be63bc1ebeeb41f6ba52f0f">_p3PRI_KEY_SERVER_C</a></td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3pri__key__server_8c.html#0edcd21f595ebaf5ef29d150680aef15">init_key_serv</a> (<a class="el" href="struct__p3key__serv.html">p3key_serv</a> *kserv)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">int&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3pri__key__server_8c.html#57da622d9c7396cebb20afdad7ff5d92">buffer_handler</a> ()</td></tr>

<tr><td colspan="2"><br><h2>Variables</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct__p3key__serv.html">p3key_serv</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3pri__key__server_8c.html#2e0699dc92f09fd54e9ef8ebda182721">key_serv</a> = NULL</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct__p3key.html">p3key</a>&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3pri__key__server_8c.html#99085a670d3ec37129c61f9e33aef809">keysrv_key</a></td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top"><a class="el" href="struct__p3key.html">p3key</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="p3pri__key__server_8c.html#f8d82c5dfe549f124a08b7aca6abc513">ks_key</a> = &amp;<a class="el" href="p3pri__key__server_8c.html#99085a670d3ec37129c61f9e33aef809">keysrv_key</a></td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="0419ecb87be63bc1ebeeb41f6ba52f0f"></a><!-- doxytag: member="p3pri_key_server.c::_p3PRI_KEY_SERVER_C" ref="0419ecb87be63bc1ebeeb41f6ba52f0f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define _p3PRI_KEY_SERVER_C          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="0edcd21f595ebaf5ef29d150680aef15"></a><!-- doxytag: member="p3pri_key_server.c::init_key_serv" ref="0edcd21f595ebaf5ef29d150680aef15" args="(p3key_serv *kserv)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int init_key_serv           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct__p3key__serv.html">p3key_serv</a> *&nbsp;</td>
          <td class="paramname"> <em>kserv</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b>Function:</b></dt><dd>init_key_serv</dd></dl>
<dl class="user" compact><dt><b>Description:</b></dt><dd>Initialize the key server data structure and the circular buffer shared with the kernel module. This memory includes the key server data structure at the beginning, followed by the circular buffer.</dd></dl>
The circular buffer is an array of pointers to keys, because the keys used by different sessions can be different sizes. The kernel module can use a key if the head and tail indexes are not equal.<p>
<dl class="user" compact><dt><b>Inputs:</b></dt><dd><ul>
<li>kserv: The location of the key server structure in the mmap'ed buffer.</li></ul>
</dd></dl>
<dl class="user" compact><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status<ul>
<li>0 = OK</li><li>&lt;0 = Error </li></ul>
</li></ul>
</dd></dl>

<p>References <a class="el" href="p3pri__key__server_8c-source.html#l00103">buffer_handler()</a>, <a class="el" href="mdefs_8h-source.html#l00019">NULL</a>, <a class="el" href="p3profile_8c-source.html#l00387">p3errmsg()</a>, <a class="el" href="p3crypto_8h-source.html#l00025">p3MAX_KSIZE</a>, <a class="el" href="p3base_8h-source.html#l00047">p3MSG_ERR</a>, and <a class="el" href="p3crypto_8h-source.html#l00041">_p3key::size</a>.</p>

<p>Referenced by <a class="el" href="p3utils_8c-source.html#l00093">init_kernel_comm()</a>.</p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="p3pri__key__server_8c_0edcd21f595ebaf5ef29d150680aef15_cgraph.png" border="0" usemap="#p3pri__key__server_8c_0edcd21f595ebaf5ef29d150680aef15_cgraph_map" alt=""></center>
<map name="p3pri__key__server_8c_0edcd21f595ebaf5ef29d150680aef15_cgraph_map">
<area shape="rect" href="p3pri__key__server_8c.html#57da622d9c7396cebb20afdad7ff5d92" title="buffer_handler" alt="" coords="159,56,271,83"><area shape="rect" href="p3profile_8c.html#115044c21fee0be99499431a0d3cabdc" title="p3errmsg" alt="" coords="465,56,548,83"><area shape="rect" href="p3crypto_8c.html#cdaa80371416def48998e5ff2e8d1471" title="p3_get_key" alt="" coords="321,5,415,32"></map>
</div>

</div>
</div><p>
<a class="anchor" name="57da622d9c7396cebb20afdad7ff5d92"></a><!-- doxytag: member="p3pri_key_server.c::buffer_handler" ref="57da622d9c7396cebb20afdad7ff5d92" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int buffer_handler           </td>
          <td>(</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
<dl class="user" compact><dt><b>Function:</b></dt><dd>buffer_handler</dd></dl>
<dl class="user" compact><dt><b>Description:</b></dt><dd>Handle the circular buffer shared with the kernel module. This is done when the tail index is not equal to the head index. In this case, a new key is created in the current head slot and the head pointer is incremented to indicate that the key is available.</dd></dl>
<dl class="user" compact><dt><b>Inputs:</b></dt><dd><ul>
<li>None</li></ul>
</dd></dl>
<dl class="user" compact><dt><b>Outputs:</b></dt><dd><ul>
<li>int: Status<ul>
<li>0 = OK</li><li>&lt;0 = Error </li></ul>
</li></ul>
</dd></dl>

<p>References <a class="el" href="p3pri__key__server_8h-source.html#l00032">_p3key_serv::cbuf_sz</a>, <a class="el" href="p3pri__key__server_8h-source.html#l00030">_p3key_serv::head</a>, <a class="el" href="p3crypto_8h-source.html#l00040">_p3key::key</a>, <a class="el" href="mdefs_8h-source.html#l00019">NULL</a>, <a class="el" href="p3crypto_8c-source.html#l00042">p3_get_key()</a>, <a class="el" href="p3primary_8c-source.html#l00074">p3buf</a>, <a class="el" href="p3profile_8c-source.html#l00387">p3errmsg()</a>, <a class="el" href="p3base_8h-source.html#l00051">p3MSG_DEBUG</a>, <a class="el" href="p3crypto_8h-source.html#l00041">_p3key::size</a>, and <a class="el" href="p3pri__key__server_8h-source.html#l00031">_p3key_serv::tail</a>.</p>

<p>Referenced by <a class="el" href="p3pri__key__server_8c-source.html#l00051">init_key_serv()</a>.</p>

<p>
<div class="dynheader">
Here is the call graph for this function:</div>
<div class="dynsection">
<p><center><img src="p3pri__key__server_8c_57da622d9c7396cebb20afdad7ff5d92_cgraph.png" border="0" usemap="#p3pri__key__server_8c_57da622d9c7396cebb20afdad7ff5d92_cgraph_map" alt=""></center>
<map name="p3pri__key__server_8c_57da622d9c7396cebb20afdad7ff5d92_cgraph_map">
<area shape="rect" href="p3crypto_8c.html#cdaa80371416def48998e5ff2e8d1471" title="p3_get_key" alt="" coords="169,5,263,32"><area shape="rect" href="p3profile_8c.html#115044c21fee0be99499431a0d3cabdc" title="p3errmsg" alt="" coords="313,31,396,57"></map>
</div>

</div>
</div><p>
<hr><h2>Variable Documentation</h2>
<a class="anchor" name="2e0699dc92f09fd54e9ef8ebda182721"></a><!-- doxytag: member="p3pri_key_server.c::key_serv" ref="2e0699dc92f09fd54e9ef8ebda182721" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct__p3key__serv.html">p3key_serv</a>* <a class="el" href="p3pri__key__server_8c.html#2e0699dc92f09fd54e9ef8ebda182721">key_serv</a> = NULL          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The main key server data structure 
<p>Referenced by <a class="el" href="p3kcrypto_8c-source.html#l00091">p3_get_key()</a>.</p>

</div>
</div><p>
<a class="anchor" name="99085a670d3ec37129c61f9e33aef809"></a><!-- doxytag: member="p3pri_key_server.c::keysrv_key" ref="99085a670d3ec37129c61f9e33aef809" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct__p3key.html">p3key</a> <a class="el" href="p3pri__key__server_8c.html#99085a670d3ec37129c61f9e33aef809">keysrv_key</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
The key server uses a single key structure 
</div>
</div><p>
<a class="anchor" name="f8d82c5dfe549f124a08b7aca6abc513"></a><!-- doxytag: member="p3pri_key_server.c::ks_key" ref="f8d82c5dfe549f124a08b7aca6abc513" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="struct__p3key.html">p3key</a> * <a class="el" href="p3pri__key__server_8c.html#f8d82c5dfe549f124a08b7aca6abc513">ks_key</a> = &amp;<a class="el" href="p3pri__key__server_8c.html#99085a670d3ec37129c61f9e33aef809">keysrv_key</a>          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>

</div>
</div><p>
</div>
<hr size="1"><address style="text-align: right;"><small>Generated on Fri Sep 24 10:44:31 2010 for Velocite Systems Protected Point to Point Solution by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.6 </small></address>
</body>
</html>
